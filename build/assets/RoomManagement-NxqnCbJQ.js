import{u as q,r as l,m as k,n as y,j as e,B as d,o as G,C as x,c as j,d as f,x as g,I,L as R,p as J,y as O,X as Y,b as S,t as i,T as Z}from"./index-D9PHDzQu.js";function ee({room:t,onBack:N}){const{user:u}=q(),[o,_]=l.useState(t.name),[b,D]=l.useState([]),[w,A]=l.useState([]),[C,M]=l.useState(""),[P,h]=l.useState([]),[T,z]=l.useState(!0),B=u?.role==="admin",E=u?.role==="moderator",L=t.created_by===u?.id,W=B||E||t.type==="private"&&L;l.useEffect(()=>{m()},[t.id]);const m=async()=>{try{const s=t.members.map(a=>k.getById(a)),n=(await Promise.all(s)).map(a=>a.user).filter(Boolean);D(n);const c=t.pinned_message_ids||(t.pinned_message_id?[t.pinned_message_id]:[]);if(c.length>0){const U=(await y.get(t.id)).messages.filter(v=>c.includes(v.id)),V=c.map(v=>U.find(X=>X.id===v)).filter(Boolean);A(V)}}catch(s){console.error("Failed to load room data:",s)}finally{z(!1)}},H=async()=>{if(!(!o.trim()||o===t.name))try{i.success("–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω–æ"),t.name=o}catch(s){i.error(s.message||"–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è")}},p=async s=>{const r=s??C;if(!r.trim()||r.length<2){h([]);return}try{const c=(await k.search(r)).users||[];h(c.filter(a=>a.id!==u?.id&&!t.members.includes(a.id)))}catch(n){console.error("–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞:",n),i.error("–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞"),h([])}},Q=async s=>{try{await S.invite(t.id,s),i.success("–£—á–∞—Å—Ç–Ω–∏–∫ –¥–æ–±–∞–≤–ª–µ–Ω"),M(""),h([]),m()}catch(r){i.error(r.message||"–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–∞")}},F=async s=>{if(confirm("–£–¥–∞–ª–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞ –∏–∑ –∫–æ–º–Ω–∞—Ç—ã?"))try{i.success("–£—á–∞—Å—Ç–Ω–∏–∫ —É–¥–∞–ª–µ–Ω"),m()}catch(r){i.error(r.message||"–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–∞")}},K=async()=>{if(confirm("–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ!"))try{const r=(await y.get(t.id)).messages;for(const n of r)await y.delete(n.id);i.success("–ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞ –æ—á–∏—â–µ–Ω–∞")}catch(s){i.error(s.message||"–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏")}};return W?T?e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx("p",{children:"–ó–∞–≥—Ä—É–∑–∫–∞..."})}):e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"border-b p-4 flex items-center gap-3 bg-background",children:[e.jsx(d,{variant:"ghost",size:"icon",onClick:N,children:e.jsx(G,{className:"w-5 h-5"})}),e.jsx("h2",{children:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–Ω–∞—Ç–æ–π"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-6",children:[e.jsxs(x,{children:[e.jsx(j,{children:e.jsx(f,{children:"–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã"})}),e.jsx(g,{className:"space-y-3",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{value:o,onChange:s=>_(s.target.value),placeholder:"–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã"}),e.jsx(d,{onClick:H,disabled:!o.trim()||o===t.name,children:"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"})]})})]}),e.jsxs(x,{children:[e.jsx(j,{children:e.jsxs(f,{children:["–£—á–∞—Å—Ç–Ω–∏–∫–∏ (",b.length,")"]})}),e.jsxs(g,{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"–î–æ–±–∞–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{value:C,onChange:s=>{M(s.target.value),p(s.target.value)},placeholder:"–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...",onKeyDown:s=>s.key==="Enter"&&p()}),e.jsx(d,{onClick:()=>p(),children:e.jsx(J,{className:"w-4 h-4"})})]}),P.length>0&&e.jsx("div",{className:"border rounded-lg divide-y",children:P.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2",children:[e.jsxs("div",{children:[e.jsx("p",{children:s.username}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.email})]}),e.jsx(d,{size:"sm",onClick:()=>Q(s.id),children:"–î–æ–±–∞–≤–∏—Ç—å"})]},s.id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"–¢–µ–∫—É—â–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏"}),e.jsx("div",{className:"border rounded-lg divide-y max-h-64 overflow-y-auto",children:b.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2",children:[e.jsxs("div",{children:[e.jsx("p",{children:s.username}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.role==="admin"&&"üëë –ê–¥–º–∏–Ω",s.role==="moderator"&&"üõ°Ô∏è –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä",s.role==="vip"&&"‚≠ê VIP",s.role==="user"&&"üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"]})]}),s.id!==t.created_by&&s.id!==u?.id&&e.jsx(d,{size:"sm",variant:"outline",onClick:()=>F(s.id),children:e.jsx(O,{className:"w-4 h-4"})})]},s.id))})]})]})]}),e.jsxs(x,{children:[e.jsx(j,{children:e.jsx(f,{children:"–ó–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è"})}),e.jsx(g,{children:w.length>0?e.jsx("div",{className:"space-y-2",children:w.map(s=>{const r=n=>{const c=n.type;if(c==="video")return"üé• –í–∏–¥–µ–æ";if(c==="voice"||c==="audio")return"üé§ –ì–æ–ª–æ—Å–æ–≤–æ–µ";const a=n.content;if(a.startsWith("![")&&a.includes("]("))return"üñºÔ∏è –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ";if(a.startsWith("http://")||a.startsWith("https://")){if(a.includes("/voice/")||a.includes("/audio/")||a.includes("voice")||a.includes("audio"))return"üé§ –ì–æ–ª–æ—Å–æ–≤–æ–µ";if(a.includes("/video/")||a.includes("video"))return"üé• –í–∏–¥–µ–æ";if(a.includes("/images/")||a.includes("/image/")||a.includes("images")||a.includes("image"))return"üñºÔ∏è –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ";if(a.includes("/storage/v1/object/"))return"üìé –§–∞–π–ª"}return a.length>100?a.substring(0,100)+"...":a};return e.jsxs("div",{className:"border rounded-lg p-3 flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s.sender_username}),e.jsx("p",{className:"text-sm",children:r(s)})]}),e.jsx(d,{size:"sm",variant:"ghost",onClick:async()=>{try{await S.unpinMessage(t.id,s.id),i.success("–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–∫—Ä–µ–ø–ª–µ–Ω–æ"),m()}catch(n){i.error(n.message||"–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä–µ–ø–ª–µ–Ω–∏—è")}},children:e.jsx(Y,{className:"w-4 h-4"})})]},s.id)})}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"–ù–µ—Ç –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π"})})]}),e.jsxs(x,{className:"border-destructive",children:[e.jsx(j,{children:e.jsx(f,{className:"text-destructive",children:"–û–ø–∞—Å–Ω–∞—è –∑–æ–Ω–∞"})}),e.jsx(g,{className:"space-y-3",children:e.jsxs(d,{variant:"outline",className:"w-full justify-start text-destructive border-destructive hover:bg-destructive/10",onClick:K,children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞"]})})]})]})]}):e.jsxs("div",{className:"h-full flex flex-col items-center justify-center",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —ç—Ç–æ–π –∫–æ–º–Ω–∞—Ç–æ–π"}),e.jsx(d,{onClick:N,children:"–ù–∞–∑–∞–¥"})]})}export{ee as R};
