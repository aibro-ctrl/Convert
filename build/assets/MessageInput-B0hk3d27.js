import{u as Ue,r as a,D as Ae,j as e,f as we,B as N,F as Ze,U as Ge,t as z,m as Je,k as de,V as es,a as ss,R as Ie,v as De,I as ke,G as ts,J as rs,K as ns,g as as,T as os,n as pe,b as is,X as be,N as ze,O as $e,Q as Ve,L as Ne,W as ls,Y as cs,Z as ds,_ as us,$ as ms,a0 as hs,a1 as ge}from"./index-D9PHDzQu.js";import{d as fs,e as Ce}from"./messageEncryption-Bi4GA-wm.js";import{A as We,a as _e,b as Be}from"./avatar-CUJzzkaW.js";import{D as ue,b as me,c as ve,d as je}from"./dialog-DY9M37Cv.js";import{f as ee}from"./urlFix-Ck1V5EyF.js";import{P as Xe,a as He,V as Ke,C as xs,c as Fe}from"./imageCompression-DOYNJt-j.js";const Re={q:"–π",w:"—Ü",e:"—É",r:"–∫",t:"–µ",y:"–Ω",u:"–≥",i:"—à",o:"—â",p:"–∑","[":"—Ö","]":"—ä",a:"—Ñ",s:"—ã",d:"–≤",f:"–∞",g:"–ø",h:"—Ä",j:"–æ",k:"–ª",l:"–¥",";":"–∂","'":"—ç",z:"—è",x:"—á",c:"—Å",v:"–º",b:"–∏",n:"—Ç",m:"—å",",":"–±",".":"—é","/":".","`":"—ë",Q:"–ô",W:"–¶",E:"–£",R:"–ö",T:"–ï",Y:"–ù",U:"–ì",I:"–®",O:"–©",P:"–ó","{":"–•","}":"–™",A:"–§",S:"–´",D:"–í",F:"–ê",G:"–ü",H:"–†",J:"–û",K:"–õ",L:"–î",":":"–ñ",'"':"–≠",Z:"–Ø",X:"–ß",C:"–°",V:"–ú",B:"–ò",N:"–¢",M:"–¨","<":"–ë",">":"–Æ","?":",","~":"–Å","@":'"',"#":"‚Ññ",$:";","^":":","&":"?"},Ye={–π:"q",—Ü:"w",—É:"e",–∫:"r",–µ:"t",–Ω:"y",–≥:"u",—à:"i",—â:"o",–∑:"p",—Ö:"[",—ä:"]",—Ñ:"a",—ã:"s",–≤:"d",–∞:"f",–ø:"g",—Ä:"h",–æ:"j",–ª:"k",–¥:"l",–∂:";",—ç:"'",—è:"z",—á:"x",—Å:"c",–º:"v",–∏:"b",—Ç:"n",—å:"m",–±:",",—é:".",".":"/",—ë:"`",–ô:"Q",–¶:"W",–£:"E",–ö:"R",–ï:"T",–ù:"Y",–ì:"U",–®:"I",–©:"O",–ó:"P",–•:"{",–™:"}",–§:"A",–´:"S",–í:"D",–ê:"F",–ü:"G",–†:"H",–û:"J",–õ:"K",–î:"L",–ñ:":",–≠:'"',–Ø:"Z",–ß:"X",–°:"C",–ú:"V",–ò:"B",–¢:"N",–¨:"M",–ë:"<",–Æ:">",",":"?",–Å:"~",'"':"@","‚Ññ":"#",";":"$",":":"^","?":"&"};function ps(s){if(!s||s.trim().length===0)return"en";let r=0,m=0;for(const h of s)Re[h]?r++:Ye[h]&&m++;return r>m*1.5?"en":m>r*1.5?"ru":"mixed"}function gs(s,r="auto",m="auto"){if(!s||s.trim().length===0||(r==="auto"&&(r=ps(s)),m==="auto"&&(m=r==="en"?"ru":"en"),r===m))return s;const h=r==="en"?Re:Ye;let l="";for(const i of s)h[i]?l+=h[i]:l+=i;return l}function vs(s){return/[–∞-—è—ë–ê-–Ø–Å]/.test(s)}function js(s){if(!/^[a-zA-Z]+$/.test(s))return!1;for(const r of s)if(!Re[r])return!1;return!0}const Te=new Set(["–∫–∞–∫","–¥–µ–ª–∞","–ø—Ä–∏–≤–µ—Ç","–ø–æ–∫–∞","—Å–ø–∞—Å–∏–±–æ","–ø–æ–∂–∞–ª—É–π—Å—Ç–∞","–¥–∞","–Ω–µ—Ç","—Ö–æ—Ä–æ—à–æ","–ø–ª–æ—Ö–æ","—Å–µ–≥–æ–¥–Ω—è","–∑–∞–≤—Ç—Ä–∞","–≤—á–µ—Ä–∞","—Å–µ–π—á–∞—Å","–ø–æ—Ç–æ–º","–≥–¥–µ","–∫–æ–≥–¥–∞","—á—Ç–æ","–∫—Ç–æ","–ø–æ—á–µ–º—É","–∫–∞–∫–æ–π","–∫–∞–∫–∞—è","–∫–∞–∫–æ–µ","—ç—Ç–æ","—Ç–æ","—Ç—É—Ç","—Ç–∞–º","–∑–¥–µ—Å—å","—Ç–∞–º","—Ç—É–¥–∞","—Å—é–¥–∞","—è","—Ç—ã","–æ–Ω","–æ–Ω–∞","–æ–Ω–æ","–º—ã","–≤—ã","–æ–Ω–∏","–º–æ–π","—Ç–≤–æ–π","–µ–≥–æ","–µ—ë","–Ω–∞—à","–≤–∞—à","–∏—Ö","–±—ã—Ç—å","–µ—Å—Ç—å","–±—ã–ª","–±—ã–ª–∞","–±—ã–ª–æ","–±—ã–ª–∏","–¥–µ–ª–∞—Ç—å","–¥–µ–ª–∞—é","–¥–µ–ª–∞–µ—à—å","–¥–µ–ª–∞–µ—Ç","–¥–µ–ª–∞–µ–º","–¥–µ–ª–∞–µ—Ç–µ","–¥–µ–ª–∞—é—Ç","–∏–¥—Ç–∏","–∏–¥—É","–∏–¥–µ—à—å","–∏–¥–µ—Ç","–∏–¥–µ–º","–∏–¥–µ—Ç–µ","–∏–¥—É—Ç","–≥–æ–≤–æ—Ä–∏—Ç—å","–≥–æ–≤–æ—Ä—é","–≥–æ–≤–æ—Ä–∏—à—å","–≥–æ–≤–æ—Ä–∏—Ç","–≥–æ–≤–æ—Ä–∏–º","–≥–æ–≤–æ—Ä–∏—Ç–µ","–≥–æ–≤–æ—Ä—è—Ç","–∑–Ω–∞—Ç—å","–∑–Ω–∞—é","–∑–Ω–∞–µ—à—å","–∑–Ω–∞–µ—Ç","–∑–Ω–∞–µ–º","–∑–Ω–∞–µ—Ç–µ","–∑–Ω–∞—é—Ç","—Ö–æ—Ç–µ—Ç—å","—Ö–æ—á—É","—Ö–æ—á–µ—à—å","—Ö–æ—á–µ—Ç","—Ö–æ—Ç–∏–º","—Ö–æ—Ç–∏—Ç–µ","—Ö–æ—Ç—è—Ç","–º–æ–≥—É","–º–æ–∂–µ—à—å","–º–æ–∂–µ—Ç","–º–æ–∂–µ–º","–º–æ–∂–µ—Ç–µ","–º–æ–≥—É—Ç","–Ω—É–∂–Ω–æ","–Ω–∞–¥–æ","–¥–æ–ª–∂–µ–Ω","–¥–æ–ª–∂–Ω–∞","–¥–æ–ª–∂–Ω–æ","–¥–æ–ª–∂–Ω—ã","–º–æ–∂–Ω–æ","–Ω–µ–ª—å–∑—è","—Ö–æ—Ä–æ—à–∏–π","–ø–ª–æ—Ö–æ–π","–±–æ–ª—å—à–æ–π","–º–∞–ª–µ–Ω—å–∫–∏–π","–Ω–æ–≤—ã–π","—Å—Ç–∞—Ä—ã–π","–º–æ–ª–æ–¥–æ–π","—Å—Ç–∞—Ä—ã–π","–∫—Ä–∞—Å–∏–≤—ã–π","—É—Ä–æ–¥–ª–∏–≤—ã–π","–¥–µ–Ω—å","–Ω–æ—á—å","—É—Ç—Ä–æ","–≤–µ—á–µ—Ä","–Ω–µ–¥–µ–ª—è","–º–µ—Å—è—Ü","–≥–æ–¥","–¥–æ–º","—Ä–∞–±–æ—Ç–∞","—à–∫–æ–ª–∞","—É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç","–¥—Ä—É–≥","–ø–æ–¥—Ä—É–≥–∞","–ª—é–±–æ–≤—å","–∂–∏–∑–Ω—å","—Å–º–µ—Ä—Ç—å","—Å—á–∞—Å—Ç—å–µ","–≥—Ä—É—Å—Ç—å","—Ä–∞–¥–æ—Å—Ç—å","–µ–¥–∞","–≤–æ–¥–∞","—Ö–ª–µ–±","–º–æ–ª–æ–∫–æ","–º—è—Å–æ","—Ä—ã–±–∞","–æ–≤–æ—â–∏","–º–∞—à–∏–Ω–∞","–∞–≤—Ç–æ–±—É—Å","–ø–æ–µ–∑–¥","—Å–∞–º–æ–ª–µ—Ç","–∫–æ—Ä–∞–±–ª—å","–≥–æ—Ä–æ–¥","–¥–µ—Ä–µ–≤–Ω—è","—Å—Ç—Ä–∞–Ω–∞","–º–∏—Ä","–∑–µ–º–ª—è","–Ω–µ–±–æ","—Å–æ–ª–Ω—Ü–µ","–ª—É–Ω–∞","–∑–≤–µ–∑–¥–∞","–¥–æ–∂–¥—å","—Å–Ω–µ–≥","–≤–µ—Ç–µ—Ä","–∏","–∏–ª–∏","–Ω–æ","–∞","—á—Ç–æ–±—ã","–ø–æ—Ç–æ–º—É","—á—Ç–æ","–≤","–Ω–∞","–ø–æ–¥","–Ω–∞–¥","–∑–∞","–ø–µ—Ä–µ–¥","–æ–∫–æ–ª–æ","–º–µ–∂–¥—É","–∫","–æ—Ç","–¥–æ","–∏–∑","—Å","–±–µ–∑","–¥–ª—è","–ø—Ä–æ"]);function ws(s,r){const m=s.length,h=r.length,l=Array(m+1).fill(null).map(()=>Array(h+1).fill(0));for(let i=0;i<=m;i++)l[i][0]=i;for(let i=0;i<=h;i++)l[0][i]=i;for(let i=1;i<=m;i++)for(let p=1;p<=h;p++)s[i-1]===r[p-1]?l[i][p]=l[i-1][p-1]:l[i][p]=Math.min(l[i-1][p]+1,l[i][p-1]+1,l[i-1][p-1]+1);return l[m][h]}function Oe(s,r=2){if(Te.has(s.toLowerCase()))return null;let m=null,h=r+1;for(const l of Te){if(Math.abs(s.length-l.length)>r)continue;const i=ws(s.toLowerCase(),l);i<h&&i<=r&&(h=i,m=l)}return m}function ys(s){return s.replace(/([–∞-—è—ë–ê-–Ø–Åa-zA-Z])\s+([–∞-—è—ë–ê-–Ø–Åa-zA-Z])/g,(r,m,h)=>m+h)}function bs(s){if(!s||s.trim().length===0)return s;let r=ys(s);const m=[],h=/\b\w+\b/g;let l=0,i;const p=[];for(;(i=h.exec(r))!==null;)p.push({start:i.index,end:i.index+i[0].length,word:i[0]});for(let d=0;d<p.length;d++){const g=p[d];g.start>l&&m.push({text:r.substring(l,g.start),isWord:!1}),m.push({text:g.word,isWord:!0}),l=g.end}if(l<r.length&&m.push({text:r.substring(l),isWord:!1}),m.length===0)return r;const j=[];for(const d of m){if(!d.isWord){j.push(d.text);continue}let g=d.text;if(vs(g)){const b=Oe(g,2);b&&(g[0]===g[0].toUpperCase()?g=b.charAt(0).toUpperCase()+b.slice(1):g=b),j.push(g);continue}if(js(g)){let b=gs(g,"en","ru");const I=Oe(b,2);I&&(b[0]===b[0].toUpperCase()?b=I.charAt(0).toUpperCase()+I.slice(1):b=I),j.push(b);continue}j.push(g)}return j.join("")}function Ns({content:s,pollId:r,onVote:m}){const{user:h}=Ue(),[l,i]=a.useState(null),[p,j]=a.useState(null),[d,g]=a.useState(!1),[b,I]=a.useState(!1),[U,$]=a.useState(!1),[w,c]=a.useState([]);a.useEffect(()=>{V();const u=setInterval(V,5e3);return()=>clearInterval(u)},[r]);const V=async()=>{try{const u=await Ae.get(r);if(u.poll&&(i(u.poll),h)){for(const[f,k]of Object.entries(u.poll.votes))if(k.includes(h.id)){g(!0),j(parseInt(f));break}}}catch(u){console.error("Error loading poll from server:",u);const f=s.split(`
`).filter(_=>_.trim());if(f.length<2)return;const k=f[0],P=k.includes("üîí"),F=k.replace("üìä ","").replace(" üîí [–ê–Ω–æ–Ω–∏–º—ã–π]","").replace(" üîí [–ê–Ω–æ–Ω–∏–º–Ω—ã–π]","").trim(),W=[];for(let _=1;_<f.length;_++){const q=f[_].match(/^(\d+)\.\s+(.+)$/);if(q){const Z=q[2];W.push(Z)}}const te={id:r,message_id:r,question:F,options:W,votes:{},anonymous:P,created_by:"",created_at:new Date().toISOString()};i(te)}},M=async u=>{if(!(!r||!h||b||d)){I(!0);try{if(await Ae.vote(r,u),j(u),g(!0),l){const f={...l.votes},k=u.toString();f[k]||(f[k]=[]),f[k]=[...f[k],h.id],i({...l,votes:f})}z.success("–í–∞—à –≥–æ–ª–æ—Å —É—á—Ç–µ–Ω"),setTimeout(()=>V(),500),m&&m()}catch(f){console.error("Error voting:",f),z.error(f.message||"–û—à–∏–±–∫–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è")}finally{I(!1)}}};if(!l)return e.jsx("div",{className:"space-y-2",children:e.jsx("p",{className:"whitespace-pre-wrap break-words",children:s})});const{question:X,options:v,anonymous:E,votes:A}=l,C={},S={};for(let u=0;u<v.length;u++)C[u]=0,S[u]=[];for(const[u,f]of Object.entries(A)){const k=parseInt(u);C[k]=f.length,S[k]=f}const L=Object.values(C).reduce((u,f)=>u+f,0),se=async()=>{if(!E)try{const u=new Set;Object.values(A).forEach(P=>{P.forEach(F=>u.add(F))});const f=Array.from(u).map(async P=>{try{return(await Je.getById(P)).user}catch(F){return console.error(`Failed to load voter ${P}:`,F),null}}),k=(await Promise.all(f)).filter(P=>P!==null);c(k),$(!0)}catch(u){console.error("Failed to load voters:",u),z.error("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞–≤—à–∏—Ö")}};return e.jsxs("div",{className:"space-y-3 min-w-[280px]",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-lg",children:"üìä"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold",children:X}),E&&e.jsx(we,{variant:"secondary",className:"mt-1 text-xs",children:"üîí –ê–Ω–æ–Ω–∏–º–Ω—ã–π –æ–ø—Ä–æ—Å"})]})]}),e.jsx("div",{className:"space-y-2",children:v.map((u,f)=>{const k=C[f]||0,P=L>0?k/L*100:0,F=p===f,W=S[f]||[];return e.jsxs("div",{className:"space-y-1",children:[e.jsxs(N,{variant:F?"default":"outline",className:"w-full justify-start h-auto py-3 px-4 relative overflow-hidden",onClick:()=>!d&&M(f),disabled:d||b,children:[d&&e.jsx("div",{className:"absolute inset-0 bg-primary/10 transition-all duration-300",style:{width:`${P}%`}}),e.jsxs("div",{className:"relative z-10 flex items-center justify-between w-full",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[F&&e.jsx(Ze,{className:"w-4 h-4"}),u]}),d&&e.jsxs("span",{className:"text-sm font-semibold",children:[P.toFixed(0),"% (",k,")"]})]})]}),d&&W.length>0&&e.jsxs("p",{className:"text-xs text-muted-foreground px-2",children:[W.length," ",W.length===1?"–ø—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞–ª":W.length<5?"–ø—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞–ª–∏":"–ø—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞–ª–æ"]})]},f)})}),d&&e.jsx("div",{className:"pt-2 border-t",children:E?e.jsxs("p",{className:"text-sm text-muted-foreground",children:["–í—Å–µ–≥–æ –≥–æ–ª–æ—Å–æ–≤: ",L]}):e.jsxs("button",{onClick:se,className:"text-sm text-muted-foreground hover:text-foreground transition-colors flex items-center gap-1",children:[e.jsx(Ge,{className:"w-4 h-4"}),"–í—Å–µ–≥–æ –≥–æ–ª–æ—Å–æ–≤: ",L]})}),!d&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –≤–∞—Ä–∏–∞–Ω—Ç –¥–ª—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è"}),e.jsx(ue,{open:U,onOpenChange:$,children:e.jsxs(me,{children:[e.jsx(ve,{children:e.jsxs(je,{children:["–ü—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞–ª–∏ (",L,")"]})}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:w.map(u=>{let f=-1;for(const[k,P]of Object.entries(A))if(P.includes(u.id)){f=parseInt(k);break}return e.jsxs("div",{className:"flex items-center gap-3 p-2 rounded hover:bg-accent",children:[e.jsx(We,{className:"w-10 h-10",children:u.avatar?e.jsx(_e,{src:ee(u.avatar),alt:u.username}):e.jsx(Be,{className:"bg-primary/10 text-primary",children:(u.display_name||u.username).charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:u.display_name||u.username}),e.jsxs("p",{className:"text-sm text-muted-foreground truncate",children:["@",u.username]})]}),f>=0&&e.jsx(we,{variant:"secondary",className:"text-xs",children:v[f]})]},u.id)})})]})})]})}function Le({className:s,defaultValue:r=[0],value:m,min:h=0,max:l=100,step:i=1,onValueChange:p,disabled:j=!1,orientation:d="horizontal"}){const[g,b]=a.useState(m||r),I=a.useRef(null),[U,$]=a.useState(!1),w=m!==void 0?m:g,c=a.useCallback((v,E)=>{if(!I.current||j)return;const A=I.current.getBoundingClientRect();let C;d==="horizontal"?C=Math.max(0,Math.min(1,(v-A.left)/A.width)):C=Math.max(0,Math.min(1,1-(E-A.top)/A.height));const S=l-h,L=h+C*S,se=Math.round(L/i)*i,f=[Math.max(h,Math.min(l,se))];b(f),p?.(f)},[h,l,i,j,d,p]),V=v=>{j||($(!0),c(v.clientX,v.clientY))},M=v=>{if(j)return;$(!0);const E=v.touches[0];c(E.clientX,E.clientY)};a.useEffect(()=>{if(!U)return;const v=C=>{c(C.clientX,C.clientY)},E=C=>{const S=C.touches[0];c(S.clientX,S.clientY)},A=()=>{$(!1)};return document.addEventListener("mousemove",v),document.addEventListener("touchmove",E),document.addEventListener("mouseup",A),document.addEventListener("touchend",A),()=>{document.removeEventListener("mousemove",v),document.removeEventListener("touchmove",E),document.removeEventListener("mouseup",A),document.removeEventListener("touchend",A)}},[U,c]);const X=(w[0]-h)/(l-h)*100;return e.jsxs("div",{ref:I,"data-slot":"slider",className:de("relative flex w-full touch-none items-center select-none",j&&"opacity-50 cursor-not-allowed",d==="vertical"&&"h-full min-h-44 w-auto flex-col",s),onMouseDown:V,onTouchStart:M,children:[e.jsx("div",{"data-slot":"slider-track",className:de("bg-muted relative grow overflow-hidden rounded-full",d==="horizontal"?"h-4 w-full":"h-full w-1.5"),children:e.jsx("div",{"data-slot":"slider-range",className:de("bg-primary absolute",d==="horizontal"?"h-full":"w-full bottom-0"),style:d==="horizontal"?{width:`${X}%`}:{height:`${X}%`}})}),e.jsx("div",{"data-slot":"slider-thumb",className:"border-primary bg-background ring-ring/50 absolute block size-4 shrink-0 rounded-full border shadow-sm transition-[color,box-shadow] hover:ring-4 focus-visible:ring-4 focus-visible:outline-hidden disabled:pointer-events-none disabled:opacity-50 cursor-pointer",style:d==="horizontal"?{left:`calc(${X}% - 0.5rem)`}:{bottom:`calc(${X}% - 0.5rem)`}})]})}function Cs({src:s}){const r=a.useMemo(()=>ee(s),[s]),m=a.useRef(null),[h,l]=a.useState(!1),[i,p]=a.useState(1),[j,d]=a.useState(0),[g,b]=a.useState(0);a.useEffect(()=>{const c=m.current;if(!c)return;c.volume=i;const V=()=>d(c.currentTime),M=()=>b(c.duration);return c.addEventListener("timeupdate",V),c.addEventListener("loadedmetadata",M),c.addEventListener("durationchange",M),()=>{c.removeEventListener("timeupdate",V),c.removeEventListener("loadedmetadata",M),c.removeEventListener("durationchange",M)}},[i]);const I=()=>{const c=m.current;c&&(h?c.pause():c.play(),l(!h))},U=c=>{p(c[0])},$=c=>{const V=m.current;V&&(V.currentTime=c[0],d(c[0]))},w=c=>{if(!isFinite(c))return"0:00";const V=Math.floor(c/60),M=Math.floor(c%60);return`${V}:${M.toString().padStart(2,"0")}`};return e.jsxs("div",{className:"flex flex-col gap-2 p-4 bg-gradient-to-br from-primary/5 to-primary/10 rounded-xl border border-primary/20 min-w-[250px] shadow-sm",children:[e.jsx("audio",{ref:m,src:r,onEnded:()=>l(!1),onPause:()=>l(!1),onPlay:()=>l(!0),onError:c=>{console.error("Audio playback error:",c,"URL:",r)}}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(N,{variant:"ghost",size:"icon",onClick:I,className:"shrink-0 h-10 w-10 rounded-full bg-primary/10 hover:bg-primary/20 transition-colors",children:h?e.jsx(Xe,{className:"w-5 h-5 text-primary"}):e.jsx(He,{className:"w-5 h-5 text-primary ml-0.5"})}),e.jsx("div",{className:"flex-1 space-y-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground font-mono",children:w(j)}),e.jsx(Le,{value:[j],min:0,max:g||100,step:.1,onValueChange:$,className:"flex-1"}),e.jsx("span",{className:"text-xs text-muted-foreground font-mono",children:w(g)})]})})]}),e.jsxs("div",{className:"flex items-center gap-2 px-1",children:[e.jsx(Ke,{className:"w-4 h-4 shrink-0 text-muted-foreground"}),e.jsx(Le,{value:[i],min:0,max:1,step:.1,onValueChange:U,className:"flex-1"}),e.jsxs("span",{className:"text-xs text-muted-foreground font-mono w-8 text-right",children:[Math.round(i*100),"%"]})]})]})}function ks({src:s}){const r=a.useMemo(()=>ee(s),[s]),[m,h]=a.useState(!1),[l,i]=a.useState(!0),[p,j]=a.useState(!1),d=a.useRef(null),g=a.useRef(null),b=w=>{w&&(p?w.pause():w.play(),j(!p))},I=w=>{w.stopPropagation(),i(!l),d.current&&(d.current.muted=!l),g.current&&(g.current.muted=!l)},U=()=>{h(!0)},$=w=>{w.stopPropagation(),b(d.current)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative w-64 h-64 group",children:[e.jsx("video",{ref:d,src:r,loop:!0,muted:l,autoPlay:!1,className:"w-full h-full rounded-full object-cover cursor-pointer",onClick:U,onPlay:()=>j(!0),onPause:()=>j(!1),onError:w=>{console.error("Video playback error:",w,"URL:",r)}}),e.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-primary/20 pointer-events-none"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:`w-16 h-16 rounded-full bg-black/60 backdrop-blur-sm flex items-center justify-center transition-opacity ${p?"opacity-0 group-hover:opacity-100":"opacity-100"}`,children:e.jsx(N,{variant:"ghost",size:"icon",onClick:$,className:"w-full h-full text-white hover:bg-transparent",children:p?e.jsx(Xe,{className:"w-8 h-8"}):e.jsx(He,{className:"w-8 h-8 ml-1"})})})}),e.jsx("div",{className:"absolute bottom-2 right-2",children:e.jsx(N,{variant:"ghost",size:"icon",onClick:I,className:"w-10 h-10 bg-black/60 backdrop-blur-sm text-white hover:bg-black/80 rounded-full",children:l?e.jsx(es,{className:"w-5 h-5"}):e.jsx(Ke,{className:"w-5 h-5"})})})]}),e.jsx(ue,{open:m,onOpenChange:h,children:e.jsx(me,{className:"max-w-4xl",children:e.jsx("div",{className:"relative",children:e.jsx("video",{ref:g,src:r,loop:!0,muted:l,autoPlay:!0,controls:!0,className:"w-full rounded-lg",onError:w=>{console.error("Fullscreen video playback error:",w,"URL:",r)}})})})})]})}function Ds({message:s,onReply:r,onPin:m,onDelete:h,onUserClick:l,isPinned:i,replyToMessage:p,onEdit:j}){const{user:d}=Ue(),g=ss(),[b,I]=a.useState(!1),[U,$]=a.useState(!1),[w,c]=a.useState(s.content),[V,M]=a.useState(s.content),[X,v]=a.useState(!1),[E,A]=a.useState({x:0,y:0}),C=Ie.useRef(null);a.useEffect(()=>{(async()=>{if(s.type==="video"||s.type==="voice"||s.type==="audio"){c(s.content),M(s.content);return}try{const y=await fs(s.content,g,s);c(y),M(y)}catch(y){console.error("SessionCrypto: Failed to decrypt message:",y),c(s.content)}})()},[s.content,s.id,s.type,cryptoKey]);const S=s.sender_id===d?.id,L=d&&["admin","moderator"].includes(d.role),se=d&&["admin","moderator","vip"].includes(d.role),u=s.mentions?.includes(d?.id||""),f=async n=>{try{await pe.addReaction(s.id,n),v(!1),j&&setTimeout(()=>j(),300)}catch(y){console.error("–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ä–µ–∞–∫—Ü–∏–∏:",y)}},k=async()=>{if(!V.trim()||V===w){$(!1);return}try{const n=await Ce(V,g);await pe.edit(s.id,n),$(!1),j&&j()}catch(n){console.error("–û—à–∏–±–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:",n)}},P=()=>{l&&l(s.sender_id)},F=async()=>{try{const n=await is.getOrCreateFavorites();let y=w;s.type==="video"||s.type==="voice"||s.type==="audio"||s.content.startsWith("![")&&s.content.includes("](")?y=s.content:y=await Ce(w,g),await pe.send(n.id,y,s.type,void 0),z.success("–°–æ–æ–±—â–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ"),v(!1)}catch(n){console.error("–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ:",n),z.error(n.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ")}},W=async()=>{try{const n=bs(w);if(n===w){z.info("–¢–µ–∫—Å—Ç –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è"),v(!1);return}M(n);const y=await Ce(n,g);await pe.edit(s.id,y),c(n),M(n),z.success("–°–æ–æ–±—â–µ–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ"),v(!1),j&&j()}catch(n){console.error("–û—à–∏–±–∫–∞ –±—ã—Å—Ç—Ä–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:",n),z.error(n.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –∏—Å–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ")}},te=n=>{C.current=setTimeout(()=>{const y=n.touches[0],G=Z(y.clientX,y.clientY);A(G),v(!0)},500)},_=()=>{C.current&&clearTimeout(C.current)},he=n=>{n.button===0&&(C.current=setTimeout(()=>{const y=Z(n.clientX,n.clientY);A(y),v(!0)},500))},q=()=>{C.current&&clearTimeout(C.current)},Z=(n,y)=>{let O=n,D=y;return O+224/2>window.innerWidth-16&&(O=window.innerWidth-224/2-16),O-224/2<16&&(O=224/2+16),D-300<16&&(D=316),D>window.innerHeight-16&&(D=window.innerHeight-16),{x:O,y:D}},ye=n=>{n.preventDefault();const y=Z(n.clientX,n.clientY);A(y),v(!0)};Ie.useEffect(()=>()=>{C.current&&clearTimeout(C.current)},[]);const re=async()=>{try{await navigator.clipboard.writeText(w),v(!1),z.success("–°–æ–æ–±—â–µ–Ω–∏–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ")}catch(n){console.error("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ:",n),z.error("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ")}},ae=n=>{const y=/^!\[.*?\]\((https?:\/\/[^\s)]+)\)$/,G=n.match(y);if(G){const O=G[1],D=ee(O);return e.jsx("img",{src:D,alt:"–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ",className:"max-w-full max-h-96 rounded-lg cursor-pointer object-contain",onClick:()=>window.open(D,"_blank"),loading:"lazy",onError:Y=>{console.error("Image load error:",Y,"URL:",D)}})}const H=/!\[.*?\]\((https?:\/\/[^\s)]+)\)/g;if(n.match(H)){const O=[];let D=0,Y;const xe=new RegExp(H);for(;(Y=xe.exec(n))!==null;){if(Y.index>D){const ie=n.substring(D,Y.index);O.push(e.jsx("span",{children:B(ie)},`text-${D}`))}const le=Y[1],ce=ee(le);O.push(e.jsx("img",{src:ce,alt:"–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ",className:"max-w-full max-h-96 rounded-lg cursor-pointer object-contain my-2",onClick:()=>window.open(ce,"_blank"),loading:"lazy",onError:ie=>{console.error("Image load error:",ie,"URL:",ce)}},`img-${Y.index}`)),D=xe.lastIndex}if(D<n.length){const le=n.substring(D);O.push(e.jsx("span",{children:B(le)},`text-${D}`))}return e.jsx(e.Fragment,{children:O})}return B(n)},B=n=>{const y=/(@\w+)/g;return n.split(y).map((H,oe)=>{if(H.match(y)){const O=H.substring(1),D=d?.username&&O.toLowerCase()===d.username.toLowerCase();return e.jsx("span",{className:`${D?"bg-yellow-200 dark:bg-yellow-900 px-1 rounded font-semibold":"text-blue-500 font-semibold"}`,children:H},oe)}return e.jsx("span",{children:H},oe)})},ne=["üëç","‚ù§Ô∏è","üòÇ","üòÆ","üò¢","üî•"],T=a.useMemo(()=>s.sender_display_name||s.sender_username,[s.sender_display_name,s.sender_username]),fe=a.useMemo(()=>T.charAt(0).toUpperCase(),[T]);return e.jsx("div",{id:`message-${s.id}`,className:`flex ${S?"justify-end":"justify-start"} mb-4 group relative`,children:e.jsxs("div",{className:`flex gap-2 max-w-[75%] ${S?"flex-row-reverse":"flex-row"} relative`,onTouchStart:te,onTouchEnd:_,onMouseDown:he,onMouseUp:q,onContextMenu:ye,children:[e.jsx(We,{className:"w-8 h-8 cursor-pointer flex-shrink-0",onClick:P,children:s.sender_avatar?e.jsx(_e,{src:ee(s.sender_avatar),alt:T}):e.jsx(Be,{className:"bg-primary/10 text-primary",children:fe})}),e.jsxs("div",{className:`flex flex-col ${S?"items-end":"items-start"} flex-1 min-w-0`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-sm cursor-pointer hover:underline",onClick:P,children:S?"–í—ã":T}),u&&e.jsx(we,{variant:"secondary",className:"text-xs bg-yellow-100 dark:bg-yellow-900",children:"—É–ø–æ–º–∏–Ω–∞–Ω–∏–µ"})]}),p&&e.jsxs("div",{className:"text-xs bg-muted/70 rounded px-2 py-1.5 mb-1 max-w-full border-l-2 border-primary/50",children:[e.jsxs("span",{className:"text-muted-foreground block",children:["–û—Ç–≤–µ—Ç –Ω–∞ ",p.sender_display_name||p.sender_username]}),e.jsx("span",{className:"text-foreground/80 line-clamp-1",children:(()=>{try{return cryptoKey&&cryptoKey.isReady,p.content.substring(0,50)+(p.content.length>50?"...":"")}catch{return"[üîí –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ]"}})()})]}),e.jsxs("div",{className:`${s.type==="video"?"p-0":"rounded-lg px-4 py-2"} relative ${s.type==="video"?"":S?"bg-primary text-primary-foreground":"bg-muted"} ${i?"ring-2 ring-yellow-500":""} ${u&&!S?"ring-2 ring-yellow-300 dark:ring-yellow-700":""}`,children:[i&&e.jsxs("div",{className:"flex items-center gap-1 text-xs mb-1 opacity-70",children:[e.jsx(De,{className:"w-3 h-3"}),"–ó–∞–∫—Ä–µ–ø–ª–µ–Ω–æ"]}),U?e.jsxs("div",{className:"space-y-2",children:[e.jsx(ke,{value:V,onChange:n=>M(n.target.value),onKeyDown:n=>{n.key==="Enter"&&!n.shiftKey?(n.preventDefault(),k()):n.key==="Escape"&&($(!1),M(w))},className:"text-sm",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{size:"sm",onClick:k,children:"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"}),e.jsx(N,{size:"sm",variant:"outline",onClick:()=>{$(!1),M(w)},children:"–û—Ç–º–µ–Ω–∞"})]})]}):e.jsxs(e.Fragment,{children:[s.type==="poll"?e.jsx(Ns,{content:s.content,pollId:s.id,onVote:()=>{}}):s.type==="voice"?e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm opacity-70",children:"üé§ –ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ"}),e.jsx(Cs,{src:ee(s.content)})]}):s.type==="video"?e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm opacity-70",children:"üé• –í–∏–¥–µ–æ"}),e.jsx(ks,{src:ee(s.content)})]}):e.jsx("div",{className:"whitespace-pre-wrap break-words",children:ae(w)}),e.jsxs("div",{className:"text-xs opacity-70 mt-1",children:[new Date(s.created_at).toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"}),s.edited&&e.jsx("span",{className:"ml-1",children:"(–∏–∑–º–µ–Ω–µ–Ω–æ)"})]})]})]}),s.reactions&&Object.keys(s.reactions).length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:Object.entries(s.reactions).map(([n,y])=>e.jsxs(we,{variant:"secondary",className:"text-xs cursor-pointer hover:bg-accent",onClick:()=>f(n),children:[n," ",y.length]},n))}),X&&!U&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>v(!1)}),e.jsx("div",{className:"fixed z-50 w-56 p-2 bg-background border border-border rounded-lg shadow-lg",style:{top:`${E.y}px`,left:`${E.x}px`,transform:"translate(-50%, -100%) translateY(-8px)"},children:e.jsx("div",{className:"space-y-1",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"border-b pb-2 mb-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-2 px-2",children:"–†–µ–∞–∫—Ü–∏–∏"}),e.jsx("div",{className:"grid grid-cols-6 gap-1",children:ne.map(n=>e.jsx(N,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover:bg-accent",onClick:()=>f(n),children:n},n))})]}),e.jsxs(N,{variant:"ghost",size:"sm",className:"w-full justify-start h-8",onClick:()=>{r(s),v(!1)},children:[e.jsx(ts,{className:"w-4 h-4 mr-2"}),"–û—Ç–≤–µ—Ç–∏—Ç—å"]}),e.jsxs(N,{variant:"ghost",size:"sm",className:"w-full justify-start h-8",onClick:re,children:[e.jsx(xs,{className:"w-4 h-4 mr-2"}),"–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å"]}),e.jsxs(N,{variant:"ghost",size:"sm",className:"w-full justify-start h-8",onClick:F,children:[e.jsx(rs,{className:"w-4 h-4 mr-2"}),"–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ"]}),(S||L)&&e.jsxs(N,{variant:"ghost",size:"sm",className:"w-full justify-start h-8",onClick:W,children:[e.jsx(ns,{className:"w-4 h-4 mr-2"}),"–ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ"]}),S&&e.jsxs(N,{variant:"ghost",size:"sm",className:"w-full justify-start h-8",onClick:()=>{$(!0),v(!1)},children:[e.jsx(as,{className:"w-4 h-4 mr-2"}),"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"]}),se&&!i&&e.jsxs(N,{variant:"ghost",size:"sm",className:"w-full justify-start h-8",onClick:()=>{m(s.id),v(!1)},children:[e.jsx(De,{className:"w-4 h-4 mr-2"}),"–ó–∞–∫—Ä–µ–ø–∏—Ç—å"]}),(S||L)&&e.jsxs(N,{variant:"ghost",size:"sm",className:"w-full justify-start h-8 text-destructive hover:text-destructive hover:bg-destructive/10",onClick:()=>{h(s.id),v(!1)},children:[e.jsx(os,{className:"w-4 h-4 mr-2"}),"–£–¥–∞–ª–∏—Ç—å"]})]})})})]})]})]})})}const Qe=a.forwardRef(({className:s,...r},m)=>e.jsx("textarea",{ref:m,"data-slot":"textarea",className:de("resize-none border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-input-background px-3 py-2 text-base transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),...r}));Qe.displayName="Textarea";function Rs({className:s,value:r=0,...m}){return e.jsx("div",{role:"progressbar","aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":r,"data-slot":"progress",className:de("bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",s),...m,children:e.jsx("div",{"data-slot":"progress-indicator",className:"bg-primary h-full w-full flex-1 transition-all",style:{transform:`translateX(-${100-(r||0)}%)`}})})}function zs({onSend:s,replyingTo:r,onCancelReply:m,disabled:h}){const[l,i]=a.useState(""),[p,j]=a.useState(!1),[d,g]=a.useState(""),[b,I]=a.useState(["",""]),[U,$]=a.useState(!1),[w,c]=a.useState({show:!1,message:""}),[V,M]=a.useState(!1),[X,v]=a.useState(!1),E=a.useRef(null),A=a.useRef(null),C=a.useRef(null),[S,L]=a.useState(!1),[se,u]=a.useState(0),f=a.useRef(null),k=a.useRef([]),P=a.useRef(null),[F,W]=a.useState(!1),[te,_]=a.useState(0),[he,q]=a.useState(!1),[Z,ye]=a.useState("user"),re=a.useRef(null),ae=a.useRef([]),B=a.useRef(null),ne=a.useRef(null),T=a.useRef(null),fe=()=>{!l.trim()||h||(s(l,"text",r?.id),i(""),E.current&&(E.current.style.height="auto"))},n=o=>{o.key==="Enter"&&!o.shiftKey&&(o.preventDefault(),fe())},y=o=>{i(o.target.value),E.current&&(E.current.style.height="auto",E.current.style.height=`${E.current.scrollHeight}px`)},G=async o=>{const t=o.clipboardData?.items;if(t)for(let x=0;x<t.length;x++){const R=t[x];if(R.type.startsWith("image/")){o.preventDefault();const J=R.getAsFile();if(!J)continue;try{c({show:!0,message:"–°–∂–∞—Ç–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è..."});const Q=await Fe(J);c({show:!0,message:"–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è..."});const{url:K}=await ge.uploadFile(Q);s(`![image](${K})`,"text",r?.id),c({show:!1,message:""}),z.success("–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑ –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ")}catch(Q){console.error("Error uploading pasted image:",Q),c({show:!1,message:""}),z.error(Q.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è")}return}}},H=()=>{if(!d.trim())return;const o=b.filter(x=>x.trim());if(o.length<2)return;const t=`üìä ${d}

${o.map((x,R)=>`${R+1}. ${x}`).join(`
`)}`;s(t,"poll",r?.id),j(!1),g(""),I(["",""]),$(!1)},oe=()=>{I([...b,""])},O=(o,t)=>{const x=[...b];x[o]=t,I(x)},D=o=>{b.length>2&&I(b.filter((t,x)=>x!==o))},Y=async()=>{try{const o=await navigator.mediaDevices.getUserMedia({audio:!0}),t=new MediaRecorder(o);f.current=t,k.current=[],t.ondataavailable=x=>{x.data.size>0&&k.current.push(x.data)},t.onstop=async()=>{const x=new Blob(k.current,{type:"audio/webm"});try{const R=new File([x],`voice-${Date.now()}.webm`,{type:"audio/webm"});c({show:!0,message:"–ó–∞–≥—Ä—É–∑–∫–∞ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è..."});const{url:J}=await ge.uploadFile(R);s(J,"voice",r?.id),c({show:!1,message:""}),z.success("–ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ")}catch(R){console.error("Error uploading audio:",R),c({show:!1,message:""}),z.error(R.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞—É–¥–∏–æ")}finally{o.getTracks().forEach(R=>R.stop()),u(0),P.current&&clearInterval(P.current)}},t.start(),L(!0),M(!1),v(!1),P.current=setInterval(()=>{u(x=>x+1)},1e3)}catch(o){console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –∞—É–¥–∏–æ:",o);let t=`–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É.

`;o.name==="NotAllowedError"?(t+=`–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É:

`,/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)?(t+=`üì± –ù–∞ –º–æ–±–∏–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ:
`,t+=`1. –í –¥–∏–∞–ª–æ–≥–µ –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞–∂–º–∏—Ç–µ "–†–∞–∑—Ä–µ—à–∏—Ç—å"
`,t+=`2. –ï—Å–ª–∏ –¥–∏–∞–ª–æ–≥ –Ω–µ –ø–æ—è–≤–∏–ª—Å—è, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∞–π—Ç–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
`,t+=`3. iOS: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ > Safari > –ö–∞–º–µ—Ä–∞ –∏ –ú–∏–∫—Ä–æ—Ñ–æ–Ω
`,t+="4. Android: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –±—Ä–∞—É–∑–µ—Ä–∞ > –†–∞–∑—Ä–µ—à–µ–Ω–∏—è"):(t+=`üíª –ù–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–µ:
`,t+=`1. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∏–∫–æ–Ω–∫—É üîí –≤ –∞–¥—Ä–µ—Å–Ω–æ–π —Å—Ç—Ä–æ–∫–µ
`,t+=`2. –ù–∞–π–¥–∏—Ç–µ "–ú–∏–∫—Ä–æ—Ñ–æ–Ω" –∏ –≤—ã–±–µ—Ä–∏—Ç–µ "–†–∞–∑—Ä–µ—à–∏—Ç—å"
`,t+="3. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É")):o.name==="NotFoundError"?t+="–ú–∏–∫—Ä–æ—Ñ–æ–Ω –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞.":o.name==="NotReadableError"?t+="–ú–∏–∫—Ä–æ—Ñ–æ–Ω –∑–∞–Ω—è—Ç –¥—Ä—É–≥–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º. –ó–∞–∫—Ä–æ–π—Ç–µ –¥—Ä—É–≥–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ –º–∏–∫—Ä–æ—Ñ–æ–Ω.":(t+=`–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:
`,t+=`‚Ä¢ –ú–∏–∫—Ä–æ—Ñ–æ–Ω –ø–æ–¥–∫–ª—é—á–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
`,t+=`‚Ä¢ –†–∞–∑—Ä–µ—à–µ–Ω–∏—è –¥–ª—è –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ –≤–∫–ª—é—á–µ–Ω—ã
`,t+="‚Ä¢ –°–∞–π—Ç –æ—Ç–∫—Ä—ã—Ç –ø–æ HTTPS"),z.error(t,{duration:8e3})}},xe=()=>{f.current&&S&&(f.current.stop(),L(!1))},le=()=>{f.current&&S&&(f.current.stop(),L(!1),k.current=[],u(0),P.current&&clearInterval(P.current))},ce=async()=>{try{const o=await navigator.mediaDevices.getUserMedia({video:{facingMode:Z},audio:!0});T.current=o,ne.current&&(ne.current.srcObject=o);const t=new MediaRecorder(o);re.current=t,ae.current=[],t.ondataavailable=x=>{x.data.size>0&&ae.current.push(x.data)},t.onstop=async()=>{const x=new Blob(ae.current,{type:"video/webm"});try{const R=new File([x],`video-${Date.now()}.webm`,{type:"video/webm"});c({show:!0,message:"–ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ..."});const{url:J}=await ge.uploadFile(R);s(J,"video",r?.id),c({show:!1,message:""}),z.success("–í–∏–¥–µ–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ")}catch(R){console.error("Error uploading video:",R),c({show:!1,message:""}),z.error(R.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ")}finally{T.current&&T.current.getTracks().forEach(R=>R.stop()),q(!1),_(0),B.current&&clearInterval(B.current)}},q(!0),M(!1),v(!1),W(!0),t.start(),B.current=setInterval(()=>{_(x=>{const R=x+1;return R>=60&&ie(),R})},1e3)}catch(o){console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –≤–∏–¥–µ–æ:",o);let t=`–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ.

`;o.name==="NotAllowedError"?(t+=`–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ –∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É:

`,/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)?(t+=`üì± –ù–∞ –º–æ–±–∏–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ:
`,t+=`1. –í –¥–∏–∞–ª–æ–≥–µ –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞–∂–º–∏—Ç–µ "–†–∞–∑—Ä–µ—à–∏—Ç—å"
`,t+=`2. –ï—Å–ª–∏ –¥–∏–∞–ª–æ–≥ –Ω–µ –ø–æ—è–≤–∏–ª—Å—è, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∞–π—Ç–∞
`,t+=`3. iOS: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ > Safari > –ö–∞–º–µ—Ä–∞ –∏ –ú–∏–∫—Ä–æ—Ñ–æ–Ω
`,t+="4. Android: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –±—Ä–∞—É–∑–µ—Ä–∞ > –†–∞–∑—Ä–µ—à–µ–Ω–∏—è"):(t+=`üíª –ù–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–µ:
`,t+=`1. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∏–∫–æ–Ω–∫—É üîí –≤ –∞–¥—Ä–µ—Å–Ω–æ–π —Å—Ç—Ä–æ–∫–µ
`,t+=`2. –ù–∞–π–¥–∏—Ç–µ "–ö–∞–º–µ—Ä–∞" –∏ "–ú–∏–∫—Ä–æ—Ñ–æ–Ω"
`,t+=`3. –í—ã–±–µ—Ä–∏—Ç–µ "–†–∞–∑—Ä–µ—à–∏—Ç—å" –¥–ª—è –æ–±–æ–∏—Ö
`,t+="4. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É")):o.name==="NotFoundError"?t+="–ö–∞–º–µ—Ä–∞ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã.":o.name==="NotReadableError"?t+="–ö–∞–º–µ—Ä–∞ –∑–∞–Ω—è—Ç–∞ –¥—Ä—É–≥–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º. –ó–∞–∫—Ä–æ–π—Ç–µ –¥—Ä—É–≥–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ –∫–∞–º–µ—Ä—É.":(t+=`–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:
`,t+=`‚Ä¢ –ö–∞–º–µ—Ä–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∞ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
`,t+=`‚Ä¢ –†–∞–∑—Ä–µ—à–µ–Ω–∏—è –¥–ª—è –∫–∞–º–µ—Ä—ã –≤–∫–ª—é—á–µ–Ω—ã
`,t+="‚Ä¢ –°–∞–π—Ç –æ—Ç–∫—Ä—ã—Ç –ø–æ HTTPS"),z.error(t,{duration:8e3})}},ie=()=>{re.current&&F&&(re.current.stop(),W(!1))},Se=()=>{re.current&&F&&(re.current.stop(),W(!1),ae.current=[]),T.current&&T.current.getTracks().forEach(o=>o.stop()),q(!1),_(0),B.current&&clearInterval(B.current)},qe=async()=>{if(!F)return;const o=Z==="user"?"environment":"user";ye(o),T.current&&T.current.getVideoTracks().forEach(t=>t.stop());try{const t=await navigator.mediaDevices.getUserMedia({video:{facingMode:o},audio:!1});if(ne.current&&(ne.current.srcObject=t),T.current){const x=T.current.getAudioTracks();T.current=new MediaStream([...t.getVideoTracks(),...x])}}catch(t){console.error("–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∫–∞–º–µ—Ä—ã:",t)}};a.useEffect(()=>()=>{P.current&&clearInterval(P.current),B.current&&clearInterval(B.current),T.current&&T.current.getTracks().forEach(o=>o.stop())},[]);const Pe=o=>{const t=Math.floor(o/60),x=o%60;return`${t}:${x.toString().padStart(2,"0")}`},Me=o=>{o==="camera"?C.current?.click():A.current?.click(),M(!1),v(!1)},Ee=async o=>{const t=o.target.files?.[0];if(t){A.current&&(A.current.value=""),C.current&&(C.current.value="");try{let x=t;const R=t.type;R.startsWith("image/")&&(c({show:!0,message:"–°–∂–∞—Ç–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è..."}),x=await Fe(t));const J=50*1024*1024;if(x.size>J){c({show:!1,message:""}),z.error("–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 50 –ú–ë");return}c({show:!0,message:"–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞..."});const{url:Q}=await ge.uploadFile(x);let K="text";R.startsWith("image/")?(K="text",s(`![image](${Q})`,K,r?.id)):R.startsWith("video/")?(K="video",s(Q,K,r?.id)):R.startsWith("audio/")?(K="voice",s(Q,K,r?.id)):(K="text",s(`üìé [${t.name}](${Q})`,K,r?.id)),c({show:!1,message:""}),z.success("–§–∞–π–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω")}catch(x){console.error("Error uploading file:",x),c({show:!1,message:""}),z.error(x.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞")}}};return e.jsxs("div",{className:"border-t p-4 pb-8 bg-background",children:[w.show&&e.jsx("div",{className:"mb-3 flex items-center gap-3 bg-blue-50 dark:bg-blue-950 rounded-lg px-4 py-3 border border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-sm text-blue-700 dark:text-blue-300",children:w.message})]})}),r&&e.jsxs("div",{className:"mb-2 flex items-center gap-2 bg-muted rounded-lg px-3 py-2 border-l-4 border-primary",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-xs text-muted-foreground mb-0.5",children:["–û—Ç–≤–µ—Ç –Ω–∞ ",r.sender_username]}),e.jsxs("p",{className:"text-sm truncate text-foreground/80",children:[r.content.substring(0,100),r.content.length>100?"...":""]})]}),e.jsx(N,{variant:"ghost",size:"sm",onClick:m,children:e.jsx(be,{className:"w-4 h-4"})})]}),S&&e.jsxs("div",{className:"mb-3 flex items-center gap-3 bg-red-50 dark:bg-red-950 rounded-lg px-4 py-3 border border-red-200 dark:border-red-800",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx(ze,{className:"w-3 h-3 fill-red-500 text-red-500 animate-pulse"}),e.jsx("span",{className:"text-sm",children:"–ó–∞–ø–∏—Å—å –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è..."}),e.jsx("span",{className:"text-sm font-mono",children:Pe(se)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{variant:"ghost",size:"sm",onClick:le,children:"–û—Ç–º–µ–Ω–∞"}),e.jsx(N,{variant:"default",size:"sm",onClick:xe,children:"–û—Ç–ø—Ä–∞–≤–∏—Ç—å"})]})]}),e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsx(N,{variant:"ghost",size:"icon",onClick:()=>v(!0),disabled:h||S||F,title:"–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å",className:"shrink-0",children:e.jsx($e,{className:"w-5 h-5"})}),e.jsx("input",{ref:A,type:"file",className:"hidden",onChange:Ee,accept:"image/*,video/*,audio/*,.pdf,.doc,.docx,.txt"}),e.jsx("input",{ref:C,type:"file",className:"hidden",onChange:Ee,accept:"image/*",capture:"environment"}),e.jsx("div",{className:"flex-1 relative",children:e.jsx(Qe,{ref:E,value:l,onChange:y,onKeyDown:n,onPaste:G,placeholder:h?"–í—ã –Ω–µ –º–æ–∂–µ—Ç–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è":"–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–ª–∏ –≤—Å—Ç–∞–≤—å—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ",disabled:h||S,className:"min-h-[44px] max-h-[200px] resize-none pr-12",rows:1})}),e.jsx(N,{onClick:fe,disabled:!l.trim()||h||S,size:"icon",className:"shrink-0 h-14 w-14",children:e.jsx(Ve,{className:"w-6 h-6"})})]}),e.jsx(ue,{open:p,onOpenChange:j,children:e.jsxs(me,{children:[e.jsx(ve,{children:e.jsx(je,{children:"–°–æ–∑–¥–∞—Ç—å –æ–ø—Ä–æ—Å"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ne,{htmlFor:"pollQuestion",children:"–í–æ–ø—Ä–æ—Å –æ–ø—Ä–æ—Å–∞"}),e.jsx(ke,{id:"pollQuestion",value:d,onChange:o=>g(o.target.value),placeholder:"–ß—Ç–æ –≤—ã –¥—É–º–∞–µ—Ç–µ –æ...?"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ne,{children:"–í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤"}),b.map((o,t)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ke,{value:o,onChange:x=>O(t,x.target.value),placeholder:`–í–∞—Ä–∏–∞–Ω—Ç ${t+1}`}),b.length>2&&e.jsx(N,{variant:"outline",size:"icon",onClick:()=>D(t),children:e.jsx(be,{className:"w-4 h-4"})})]},t)),e.jsx(N,{variant:"outline",onClick:oe,className:"w-full",children:"–î–æ–±–∞–≤–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç"})]}),e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-muted/50 rounded-lg",children:[e.jsx(ls,{id:"anonymous-poll",checked:U,onCheckedChange:o=>$(o)}),e.jsx(Ne,{htmlFor:"anonymous-poll",className:"cursor-pointer text-sm",children:"–ê–Ω–æ–Ω–∏–º–Ω—ã–π –æ–ø—Ä–æ—Å (–≥–æ–ª–æ—Å–∞ –Ω–µ –±—É–¥—É—Ç –≤–∏–¥–Ω—ã –¥—Ä—É–≥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º)"})]}),e.jsx(N,{onClick:H,disabled:!d.trim()||b.filter(o=>o.trim()).length<2,className:"w-full",children:"–°–æ–∑–¥–∞—Ç—å –æ–ø—Ä–æ—Å"})]})]})}),e.jsx(ue,{open:he,onOpenChange:o=>{o||Se()},children:e.jsxs(me,{className:"max-w-md",children:[e.jsx(ve,{children:e.jsx(je,{children:"–ó–∞–ø–∏—Å—å –≤–∏–¥–µ–æ —Å–æ–æ–±—â–µ–Ω–∏—è"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative w-64 h-64 mx-auto",children:[e.jsx("video",{ref:ne,autoPlay:!0,muted:!0,playsInline:!0,className:"w-full h-full object-cover rounded-full border-4 border-primary"}),F&&e.jsxs("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 bg-red-500 text-white px-3 py-1 rounded-full flex items-center gap-2",children:[e.jsx(ze,{className:"w-2 h-2 fill-white animate-pulse"}),e.jsx("span",{className:"text-sm font-mono",children:Pe(te)})]}),e.jsx(N,{variant:"secondary",size:"icon",className:"absolute bottom-4 right-4 rounded-full",onClick:qe,disabled:!F,children:e.jsx(cs,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Rs,{value:te/60*100,className:"h-2"}),e.jsx("p",{className:"text-xs text-center text-muted-foreground",children:"–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 60 —Å–µ–∫—É–Ω–¥"})]}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsxs(N,{variant:"outline",onClick:Se,className:"flex-1",children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"–û—Ç–º–µ–Ω–∞"]}),e.jsxs(N,{variant:"default",onClick:ie,disabled:!F||te<1,className:"flex-1",children:[e.jsx(Ve,{className:"w-4 h-4 mr-2"}),"–û—Ç–ø—Ä–∞–≤–∏—Ç—å"]})]})]})]})}),e.jsx(ue,{open:X,onOpenChange:v,children:e.jsxs(me,{className:"sm:max-w-md",children:[e.jsx(ve,{children:e.jsx(je,{children:"–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å"})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 py-4",children:[e.jsxs(N,{variant:"outline",className:"h-24 flex-col gap-2",onClick:()=>Me("camera"),children:[e.jsx(ds,{className:"w-8 h-8"}),e.jsx("span",{className:"text-sm",children:"–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ"})]}),e.jsxs(N,{variant:"outline",className:"h-24 flex-col gap-2",onClick:()=>Me("file"),children:[e.jsx($e,{className:"w-8 h-8"}),e.jsx("span",{className:"text-sm",children:"–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–∞–π–ª"})]}),e.jsxs(N,{variant:"outline",className:"h-24 flex-col gap-2",onClick:Y,children:[e.jsx(us,{className:"w-8 h-8"}),e.jsx("span",{className:"text-sm",children:"–ì–æ–ª–æ—Å–æ–≤–æ–µ"})]}),e.jsxs(N,{variant:"outline",className:"h-24 flex-col gap-2",onClick:ce,children:[e.jsx(ms,{className:"w-8 h-8"}),e.jsx("span",{className:"text-sm",children:"–ó–∞–ø–∏—Å–∞—Ç—å –∫—Ä—É–∂–æ–∫"})]}),e.jsxs(N,{variant:"outline",className:"h-24 flex-col gap-2 col-span-2",onClick:()=>{j(!0),v(!1)},children:[e.jsx(hs,{className:"w-8 h-8"}),e.jsx("span",{className:"text-sm",children:"–û–ø—Ä–æ—Å"})]})]})]})})]})}export{Ds as M,zs as a};
