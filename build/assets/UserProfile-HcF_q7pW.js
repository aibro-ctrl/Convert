import{r as i,j as e,k as ue,a2 as Ms,u as is,a3 as Fs,s as cs,a4 as os,a5 as ds,a6 as Y,a7 as Rs,h as H,e as Ls,a8 as Is,a9 as Q,C as M,c as X,d as J,aa as te,x as R,ab as _s,L as b,I,W as Ue,B as j,m as k,t as h,ac as K,ad as Te,f as _,X as Os,U as Ts,H as zs,A as $s,ae as qs,p as xe,af as ms,ag as ze,ah as Ze,ai as Bs,aj as me,ak as Vs,b as es,o as ss,al as _e,V as as,y as ts,M as rs,J as Gs,E as ls,am as Ws,i as Hs,S as ns,z as Ks}from"./index-D9PHDzQu.js";import{D as T,b as z,c as $,d as q}from"./dialog-DY9M37Cv.js";import{V as Ys,c as Qs}from"./imageCompression-DOYNJt-j.js";import{f as he}from"./urlFix-Ck1V5EyF.js";const fe=i.createContext(void 0);function hs({value:c,defaultValue:d,onValueChange:w,children:g}){const[f,p]=i.useState(d||""),[n,D]=i.useState(!1),S=c!==void 0?c:f,E=y=>{c===void 0&&p(y),w?.(y),D(!1)};return e.jsx(fe.Provider,{value:{value:S,onValueChange:E,open:n,setOpen:D},children:g})}function xs({placeholder:c}){const d=i.useContext(fe);return d?e.jsx("span",{"data-slot":"select-value",children:d.value||c}):null}function us({className:c,size:d="default",children:w,...g}){const f=i.useContext(fe);return f?e.jsxs("button",{type:"button","data-slot":"select-trigger","data-size":d,className:ue("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-full items-center justify-between gap-2 rounded-md border bg-input-background px-3 py-2 text-sm whitespace-nowrap transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8",c),onClick:()=>f.setOpen(!f.open),...g,children:[w,e.jsx(Ms,{className:"size-4 opacity-50"})]}):null}function fs({className:c,children:d,position:w="popper",...g}){const f=i.useContext(fe);return!f||!f.open?null:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>f.setOpen(!1)}),e.jsx("div",{"data-slot":"select-content",className:ue("bg-popover text-popover-foreground relative z-50 max-h-96 min-w-[8rem] overflow-y-auto rounded-md border shadow-md p-1 mt-1",c),...g,children:d})]})}function V({className:c,children:d,value:w,...g}){const f=i.useContext(fe);if(!f)return null;const p=f.value===w;return e.jsx("div",{"data-slot":"select-item",className:ue("focus:bg-accent focus:text-accent-foreground relative flex w-full cursor-pointer items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-none select-none hover:bg-accent hover:text-accent-foreground",p&&"bg-accent/50",c),onClick:()=>f.onValueChange(w),...g,children:d})}function Xs({className:c,checked:d,defaultChecked:w=!1,onCheckedChange:g,disabled:f=!1,name:p,value:n,id:D,...S}){const[E,y]=i.useState(w),t=d!==void 0?d:E,l=()=>{if(f)return;const o=!t;y(o),g?.(o)},r=o=>{(o.key===" "||o.key==="Enter")&&(o.preventDefault(),l())};return e.jsxs("button",{type:"button",role:"switch","aria-checked":t,"data-state":t?"checked":"unchecked","data-slot":"switch",disabled:f,className:ue("peer inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent transition-all outline-none","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","disabled:cursor-not-allowed disabled:opacity-50",t?"bg-primary":"bg-switch-background dark:bg-input/80",c),onClick:l,onKeyDown:r,id:D,...S,children:[e.jsx("input",{type:"checkbox",name:p,value:n,checked:t,onChange:()=>{},className:"sr-only",tabIndex:-1,"aria-hidden":"true"}),e.jsx("span",{"data-slot":"switch-thumb",className:ue("pointer-events-none block size-4 rounded-full ring-0 transition-transform","bg-card dark:bg-card-foreground",t?"translate-x-[calc(100%-2px)] dark:bg-primary-foreground":"translate-x-0")})]})}function Js(){const{user:c,refreshUser:d}=is(),{theme:w,setTheme:g}=Fs(),[f,p]=i.useState(""),[n,D]=i.useState(""),[S,E]=i.useState(""),[y,t]=i.useState(!1),[l,r]=i.useState(""),[o,u]=i.useState(""),[v,N]=i.useState(c?.display_name||""),[C,A]=i.useState(c?.gender||""),[re,De]=i.useState(c?.age||""),[je,Z]=i.useState(c?.interests||""),[F,G]=i.useState(c?.privacySettings||{showGender:!0,showAge:!0,showInterests:!0}),Ee=async m=>{if(m.preventDefault(),n!==S){h.error("Пароли не совпадают");return}if(n.length<6){h.error("Пароль должен содержать минимум 6 символов");return}try{await k.changePassword(f,n),h.success("Пароль успешно изменен"),p(""),D(""),E("")}catch(B){h.error(B.message||"Ошибка смены пароля")}},le=async m=>{if(m.preventDefault(),!l||!o){h.error("Заполните все поля");return}try{const B=await k.changeEmail(l,o);h.success("Email успешно изменен"),r(""),u(""),B.user&&await d()}catch(B){h.error(B.message||"Ошибка смены email")}},ne=async()=>{try{await k.updateProfile({display_name:v||void 0,gender:C||void 0,age:re?parseInt(re):void 0,interests:je||void 0,privacySettings:F}),h.success("Профиль обновлен"),await d()}catch(m){h.error(m.message||"Ошибка обновления профиля")}};return e.jsxs("div",{className:"h-full overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(cs,{className:"w-6 h-6"}),e.jsx("h2",{className:"text-2xl",children:"Настройки"})]}),e.jsxs(os,{defaultValue:"theme",className:"w-full",children:[e.jsxs(ds,{className:"w-full grid grid-cols-4",children:[e.jsxs(Y,{value:"theme",children:[e.jsx(Rs,{className:"w-4 h-4 mr-2"}),"Тема"]}),e.jsxs(Y,{value:"profile",children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Профиль"]}),e.jsxs(Y,{value:"password",children:[e.jsx(Ls,{className:"w-4 h-4 mr-2"}),"Пароль"]}),e.jsxs(Y,{value:"email",children:[e.jsx(Is,{className:"w-4 h-4 mr-2"}),"Email"]})]}),e.jsx(Q,{value:"theme",className:"space-y-4 mt-4",children:e.jsxs(M,{children:[e.jsxs(X,{children:[e.jsx(J,{children:"Цветовая тема"}),e.jsx(te,{children:"Выберите тему оформления приложения"})]}),e.jsx(R,{className:"space-y-3",children:_s.map(m=>e.jsx("div",{className:`p-4 rounded-lg border-2 cursor-pointer transition-all ${w===m.value?"border-primary bg-primary/5":"border-border hover:border-primary/50"}`,onClick:()=>g(m.value),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:m.label}),w===m.value&&e.jsx("div",{className:"w-4 h-4 rounded-full bg-primary"})]})},m.value))})]})}),e.jsx(Q,{value:"profile",className:"space-y-4 mt-4",children:e.jsxs(M,{children:[e.jsxs(X,{children:[e.jsx(J,{children:"Информация о себе"}),e.jsx(te,{children:"Дополнительные поля профиля"})]}),e.jsxs(R,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"displayName",children:"Отображаемое имя"}),e.jsx(I,{id:"displayName",type:"text",value:v,onChange:m=>N(m.target.value),placeholder:"Ваше имя (может быть на русском)"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Упоминания в чате будут работать по логину @",c?.username,", но отображаться будет это имя"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"gender",children:"Пол"}),e.jsxs(hs,{value:C,onValueChange:A,children:[e.jsx(us,{id:"gender",children:e.jsx(xs,{placeholder:"Выберите пол"})}),e.jsxs(fs,{children:[e.jsx(V,{value:"",children:"Не указано"}),e.jsx(V,{value:"male",children:"Мужской"}),e.jsx(V,{value:"female",children:"Женский"}),e.jsx(V,{value:"other",children:"Другой"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(Ue,{id:"showGender",checked:F.showGender,onCheckedChange:m=>G({...F,showGender:!!m})}),e.jsx(b,{htmlFor:"showGender",className:"text-sm text-muted-foreground cursor-pointer",children:"Показывать другим пользователям"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"age",children:"Возраст"}),e.jsx(I,{id:"age",type:"number",value:re,onChange:m=>De(m.target.value),placeholder:"Ваш возраст",min:"1",max:"120"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(Ue,{id:"showAge",checked:F.showAge,onCheckedChange:m=>G({...F,showAge:!!m})}),e.jsx(b,{htmlFor:"showAge",className:"text-sm text-muted-foreground cursor-pointer",children:"Показывать другим пользователям"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"interests",children:"Интересы"}),e.jsx(I,{id:"interests",value:je,onChange:m=>Z(m.target.value),placeholder:"Хобби, интересы..."}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(Ue,{id:"showInterests",checked:F.showInterests,onCheckedChange:m=>G({...F,showInterests:!!m})}),e.jsx(b,{htmlFor:"showInterests",className:"text-sm text-muted-foreground cursor-pointer",children:"Показывать другим пользователям"})]})]}),e.jsx(j,{onClick:ne,className:"w-full",children:"Сохранить изменения"})]})]})}),e.jsx(Q,{value:"password",className:"space-y-4 mt-4",children:e.jsxs(M,{children:[e.jsxs(X,{children:[e.jsx(J,{children:"Сменить пароль"}),e.jsx(te,{children:"Измените пароль для входа в аккаунт"})]}),e.jsx(R,{children:e.jsxs("form",{onSubmit:Ee,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"oldPassword",children:"Текущий пароль"}),e.jsx("div",{className:"relative",children:e.jsx(I,{id:"oldPassword",type:y?"text":"password",value:f,onChange:m=>p(m.target.value),required:!0})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"newPassword",children:"Новый пароль"}),e.jsx(I,{id:"newPassword",type:y?"text":"password",value:n,onChange:m=>D(m.target.value),required:!0,minLength:6})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"confirmPassword",children:"Подтвердите новый пароль"}),e.jsx(I,{id:"confirmPassword",type:y?"text":"password",value:S,onChange:m=>E(m.target.value),required:!0,minLength:6})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ue,{id:"showPasswords",checked:y,onCheckedChange:m=>t(!!m)}),e.jsx(b,{htmlFor:"showPasswords",className:"text-sm cursor-pointer",children:"Показать пароли"})]}),e.jsx(j,{type:"submit",className:"w-full",children:"Изменить пароль"})]})})]})}),e.jsx(Q,{value:"email",className:"space-y-4 mt-4",children:e.jsxs(M,{children:[e.jsxs(X,{children:[e.jsx(J,{children:"Сменить Email"}),e.jsxs(te,{children:["Текущий email: ",e.jsx("strong",{children:c?.email})]})]}),e.jsx(R,{children:e.jsxs("form",{onSubmit:le,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"newEmail",children:"Новый email"}),e.jsx(I,{id:"newEmail",type:"email",value:l,onChange:m=>r(m.target.value),required:!0,placeholder:"new@email.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"emailPassword",children:"Подтвердите паролем"}),e.jsx(I,{id:"emailPassword",type:"password",value:o,onChange:m=>u(m.target.value),required:!0})]}),e.jsx(j,{type:"submit",className:"w-full",children:"Изменить Email"})]})})]})})]})]})}function Zs({onClose:c,onFriendRequestHandled:d}){const[w,g]=i.useState([]),[f,p]=i.useState(!0);i.useEffect(()=>{n();const r=setInterval(n,3e3);return()=>clearInterval(r)},[]);const n=async()=>{if(!localStorage.getItem("access_token")){console.log("loadNotifications: No token available, skipping"),p(!1);return}try{const u=((await K.getAll()).notifications||[]).filter(v=>v&&v.id&&v.type);g(u)}catch(o){console.error("Failed to load notifications:",o),o.message&&!o.message.includes("401")&&h.error("Не удалось загрузить уведомления")}finally{p(!1)}},D=async(r,o)=>{try{g(u=>u.filter(v=>v.id!==o)),await k.acceptFriendRequest(r),await K.delete(o),g(u=>{const v=u.find(N=>N.id===o);return v&&v.fromUserId?u.filter(N=>!(N.type==="friend_request"&&N.fromUserId===v.fromUserId)):u.filter(N=>N.id!==o)}),h.success("Запрос принят. Теперь вы друзья!"),d&&d(),setTimeout(()=>{n()},500)}catch(u){console.error("Accept friend request error:",u);const v=u.message||"Ошибка";v.includes("уже обработан")||v.includes("already processed")?(h.info("Запрос уже был обработан ранее"),await K.delete(o),g(N=>N.filter(C=>C.id!==o)),g(N=>{const C=N.find(A=>A.id===o);return C&&C.fromUserId?N.filter(A=>!(A.type==="friend_request"&&A.fromUserId===C.fromUserId)):N.filter(A=>A.id!==o)}),d&&d(),setTimeout(()=>{n()},500)):(h.error(v),n())}},S=async(r,o)=>{try{await Promise.all([k.rejectFriendRequest(r),K.delete(o)]),h.success("Запрос отклонен"),g(u=>u.filter(v=>v.id!==o)),d&&d()}catch(u){console.error("Reject friend request error:",u);const v=u.message||"Ошибка";v.includes("уже обработан")||v.includes("already processed")?(h.info("Запрос уже был обработан ранее"),await K.delete(o),g(N=>N.filter(C=>C.id!==o)),d&&d()):h.error(v)}},E=async r=>{try{g(o=>o.filter(u=>u.id!==r)),await K.delete(r)}catch(o){h.error(o.message||"Ошибка"),n()}},y=r=>{switch(r){case"friend_request":return e.jsx(xe,{className:"w-5 h-5 text-blue-500"});case"friend_accepted":return e.jsx(qs,{className:"w-5 h-5 text-green-500"});case"mention":return e.jsx($s,{className:"w-5 h-5 text-purple-500"});case"reaction":return e.jsx(zs,{className:"w-5 h-5 text-pink-500"});case"room_invite":return e.jsx(Ts,{className:"w-5 h-5 text-indigo-500"});default:return e.jsx(Te,{className:"w-5 h-5"})}},t=r=>{const o=new Date(r),v=new Date().getTime()-o.getTime(),N=Math.floor(v/6e4),C=Math.floor(N/60),A=Math.floor(C/24);return N<1?"только что":N<60?`${N} мин назад`:C<24?`${C} ч назад`:A===1?"вчера":A<7?`${A} д назад`:o.toLocaleDateString("ru-RU",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"})},l=w.filter(r=>r&&!r.read).length;return e.jsxs("div",{className:"h-full flex flex-col bg-background",children:[e.jsx("div",{className:"border-b p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"w-5 h-5"}),e.jsx("h2",{className:"text-xl",children:"Уведомления"}),l>0&&e.jsx(_,{variant:"destructive",children:l})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:f?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Загрузка..."}):w.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Нет уведомлений"}):w.map(r=>!r||!r.id?null:e.jsx(M,{className:`${r.read===!1?"border-primary":""}`,children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-1",children:y(r.type)}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("p",{className:"text-sm",children:r.content||"Уведомление"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r.createdAt?t(r.createdAt):""}),r.type==="friend_request"&&r.actionData?.requestKey&&e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(j,{size:"sm",onClick:()=>D(r.actionData.requestKey,r.id),children:"Принять"}),e.jsx(j,{size:"sm",variant:"outline",onClick:()=>S(r.actionData.requestKey,r.id),children:"Отклонить"})]}),r.type!=="friend_request"&&e.jsx(j,{size:"sm",variant:"ghost",onClick:()=>E(r.id),children:"Закрыть"})]}),e.jsx(j,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>E(r.id),children:e.jsx(Os,{className:"w-4 h-4"})})]})})},r.id))})]})}const ea=({className:c})=>e.jsx("svg",{className:c,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),sa=({className:c})=>e.jsx("svg",{className:c,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})}),aa=({className:c})=>e.jsx("svg",{className:c,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"})});function Oe({userId:c}){const[d,w]=i.useState(null),[g,f]=i.useState(!0),[p,n]=i.useState("all");i.useEffect(()=>{if(c){D();const l=setInterval(()=>{D()},5e3);return()=>clearInterval(l)}},[c]);const D=async()=>{if(!c){f(!1);return}try{console.log("AchievementsPanel: Loading achievements for user:",c),f(!0);const l=await ms(`/achievements/${c}`);if(console.log("AchievementsPanel: Data received from API:",l),l&&typeof l=="object"){l.achievements||(l.achievements={});const r=Object.entries(l.achievements||{}).filter(([o,u])=>u&&u.isUnlocked===!0).map(([o,u])=>o);console.log("AchievementsPanel: Unlocked achievements:",r),console.log("AchievementsPanel: All achievements data:",Object.keys(l.achievements||{})),w(l)}else console.warn("AchievementsPanel: Invalid data format:",l),w({userId:c,achievements:{},lastUpdated:new Date().toISOString()})}catch(l){console.error("AchievementsPanel: Error loading achievements:",l),w({userId:c,achievements:{},lastUpdated:new Date().toISOString()})}finally{f(!1)}},S=l=>{const r=d?.achievements?.[l];return r||{achievementId:l,progress:0,isUnlocked:!1}},E=ze.filter(l=>p==="all"?!0:l.category===p),y={total:ze.length,unlocked:Object.values(d?.achievements||{}).filter(l=>l&&l.isUnlocked===!0).length,inProgress:Object.values(d?.achievements||{}).filter(l=>l&&l.isUnlocked!==!0&&l.progress>0).length};if(d){const l=Object.entries(d.achievements||{}).filter(([r,o])=>o&&o.isUnlocked===!0).map(([r,o])=>r);console.log("AchievementsPanel: Data loaded",{userId:c,totalAchievements:Object.keys(d.achievements||{}).length,unlocked:y.unlocked,inProgress:y.inProgress,unlockedIds:l,allAchievements:Object.keys(d.achievements||{})})}else console.log("AchievementsPanel: No achievement data yet");const t=["all","basics","social","master","media","secret","challenges"];return g?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-500/10 to-blue-500/5 rounded-lg p-4 border border-blue-500/20",children:[e.jsx("div",{className:"text-3xl mb-1",children:y.unlocked}),e.jsx("div",{className:"text-sm opacity-70",children:"Разблокировано"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-yellow-500/10 to-yellow-500/5 rounded-lg p-4 border border-yellow-500/20",children:[e.jsx("div",{className:"text-3xl mb-1",children:y.inProgress}),e.jsx("div",{className:"text-sm opacity-70",children:"В процессе"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-500/10 to-purple-500/5 rounded-lg p-4 border border-purple-500/20",children:[e.jsx("div",{className:"text-3xl mb-1",children:y.total}),e.jsx("div",{className:"text-sm opacity-70",children:"Всего"})]})]}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:t.map(l=>e.jsx("button",{onClick:()=>n(l),className:`px-4 py-2 rounded-lg transition-all ${p===l?"bg-blue-500 text-white shadow-lg":"bg-white/5 hover:bg-white/10"}`,children:l==="all"?"Все":Ze[l]},l))}),e.jsxs("div",{className:"grid gap-4",children:[E.map(l=>{const r=S(l.id),o=Bs(l,r),u=!r.isUnlocked&&l.isSecret;return r.isUnlocked===!0&&console.log(`✅ Achievement unlocked: ${l.id} (${l.name})`,{userAchievement:r,unlockedAt:r.unlockedAt}),e.jsxs("div",{className:"relative rounded-lg border overflow-hidden transition-all hover:scale-[1.02]",style:{borderColor:r.isUnlocked===!0?me[l.rarity]:"rgba(255,255,255,0.1)",backgroundColor:r.isUnlocked===!0?`${me[l.rarity]}10`:"rgba(255,255,255,0.02)",borderWidth:r.isUnlocked===!0?"2px":"1px"},children:[r.isUnlocked!==!0&&!u&&e.jsx("div",{className:"absolute bottom-0 left-0 h-1 transition-all",style:{width:`${o}%`,backgroundColor:me[l.rarity]}}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`flex-shrink-0 text-4xl transition-all ${r.isUnlocked===!0?"":"grayscale opacity-50"}`,style:{filter:r.isUnlocked===!0?"none":"grayscale(100%)"},children:u?e.jsx(ea,{className:"w-10 h-10"}):l.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"text-lg font-semibold",children:u?"???":l.name}),r.isUnlocked===!0&&e.jsx(aa,{className:"w-5 h-5 text-yellow-500 flex-shrink-0"})]}),e.jsx("div",{className:"text-sm opacity-70 mb-2",children:u?"Секретное достижение":l.description}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("div",{className:"text-xs px-2 py-1 rounded",style:{backgroundColor:`${me[l.rarity]}20`,color:me[l.rarity]},children:Vs[l.rarity]}),e.jsx("div",{className:"text-xs px-2 py-1 rounded bg-white/5",children:Ze[l.category]}),r.isUnlocked!==!0&&!u&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(sa,{className:"w-4 h-4"}),e.jsxs("span",{children:[r.progress," / ",l.maxProgress]})]}),r.isUnlocked===!0&&r.unlockedAt&&e.jsxs("div",{className:"text-xs opacity-60",children:["Разблокировано:"," ",new Date(r.unlockedAt).toLocaleDateString("ru-RU")]})]})]})]})})]},l.id)}),E.length===0&&e.jsx("div",{className:"text-center py-12 opacity-50",children:"В этой категории пока нет достижений"})]})]})}function fa({userId:c,onBack:d,onOpenChat:w,onOpenDM:g,onViewUser:f,showFriendsTab:p}){const{user:n,signout:D,refreshUser:S,godModeEnabled:E,setGodModeEnabled:y}=is(),[t,l]=i.useState(null),[r,o]=i.useState([]),[u,v]=i.useState(null),[N,C]=i.useState(!1),[A,re]=i.useState(0),[De,je]=i.useState("profile"),[Z,F]=i.useState({}),[G,Ee]=i.useState(""),[le,ne]=i.useState([]),[m,B]=i.useState(!1),ve=i.useRef(null),[ta,js]=i.useState([]),[ra,vs]=i.useState({}),[Me,ge]=i.useState(!1),[ee,gs]=i.useState(null),[pe,Ne]=i.useState(!1),[$e,qe]=i.useState(null),[Be,we]=i.useState(!1),[ps,ye]=i.useState(!1),[Fe,Ns]=i.useState(1),[ws,be]=i.useState(!1),[Re,ys]=i.useState(24),[la,na]=i.useState(""),[ia,ca]=i.useState(!1),[oa,da]=i.useState(!1),[Ve,W]=i.useState(!1),[se,ie]=i.useState(null),ke=!!c&&c!==n?.id,ae=n?.role==="admin",Ge=n?.role==="moderator"||ae,bs=n?.username==="iBro";i.useEffect(()=>{if(c&&c!==n?.id){O(c),We(c);const s=setInterval(()=>{O(c)},2e3);return()=>clearInterval(s)}else n&&!c&&(console.log("UserProfile: Loading achievements for own profile, userId:",n.id),We(n.id))},[c,n?.id]),i.useEffect(()=>{const s=a=>{pe&&(a.target.closest(".relative")||Ne(!1))};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[pe]),i.useEffect(()=>{if(p){ce(),He(),Ke();const s=setInterval(()=>{ce(),He(),Ke()},2e3);return()=>clearInterval(s)}},[p]),i.useEffect(()=>{if(n&&!p&&!c){Le();const s=setInterval(Le,3e4);return()=>clearInterval(s)}},[n,p,c]);const Le=async()=>{if(!localStorage.getItem("access_token")){console.log("loadNotificationCount: No token available, skipping");return}try{const x=(await K.getAll()).notifications?.filter(L=>!L.read).length||0;re(x)}catch(a){console.error("Failed to load notification count:",a),a.message!=="Request failed"&&console.error("Notification error details:",a)}},We=async s=>{try{console.log("UserProfile: loadAchievements called for userId:",s);const a=await ms(`/achievements/${s}`);console.log("UserProfile: Achievements data received:",a),qe(a)}catch(a){console.error("UserProfile: Error loading achievements:",a),qe({userId:s,achievements:{},lastUpdated:new Date().toISOString()})}},O=async s=>{const a=!t;a&&C(!0);try{const x=await k.getById(s);if(console.log("Loaded user profile:",{id:x.user.id,username:x.user.username,hasAvatar:!!x.user.avatar,avatarUrl:x.user.avatar?.substring(0,80)+"..."||"none"}),l(x.user),await S(),n)if(n.friends?.includes(s)||!1)F(P=>{const U={...P};return delete U[s],U});else try{(await k.checkFriendRequest(s)).pending?F(U=>({...U,[s]:!0})):F(U=>{const oe={...U};return delete oe[s],oe})}catch(P){console.log("Error checking friend request:",P)}}catch{a&&(h.error("Ошибка загрузки профиля"),d&&d())}finally{a&&C(!1)}},ce=async()=>{try{const s=await k.getFriends();console.log("Loaded friends:",s.friends?.length||0,"friends"),s.friends&&s.friends.length>0&&console.log("Friends with avatars:",s.friends.filter(a=>a.avatar).length),o(s.friends||[])}catch(s){console.error("Failed to load friends:",s)}},He=async()=>{try{const a=(await es.getAll()).rooms.filter(L=>L.type==="dm");js(a);const x={};for(const L of a)if(L.dm_participants&&n){const P=L.dm_participants.find(U=>U!==n.id);if(P&&!x[P])try{const U=await k.getById(P);x[P]=U.user}catch(U){console.error(`Failed to load user ${P}:`,U)}}vs(x)}catch(s){console.error("Failed to load DM rooms:",s)}},Ke=async()=>{try{const a=(await es.getAll()).rooms.find(x=>x.name.includes("⭐ Избранное")||x.name.includes("Избранное"));v(a||null)}catch(s){console.error("Failed to load favorites:",s)}},Ce=s=>{switch(s){case"admin":return e.jsx(ns,{className:"w-4 h-4 text-red-500"});case"moderator":return e.jsx(ns,{className:"w-4 h-4 text-blue-500"});case"vip":return e.jsx(Hs,{className:"w-4 h-4 text-yellow-500"});default:return e.jsx(H,{className:"w-4 h-4 text-gray-500"})}},Se=s=>{switch(s){case"admin":return"Администратор";case"moderator":return"Модератор";case"vip":return"VIP";default:return"Пользователь"}},ks=async(s,a)=>{if(t?.username==="iBro"&&a!=="admin"){h.error("Нельзя изменить роль первого пользователя");return}try{await k.updateRole(s,a),h.success("Роль изменена"),await S(),ke&&O(s)}catch(x){h.error(x.message||"Ошибка изменения роли")}},Cs=async()=>{if(t)try{await k.mute(t.id,Fe),h.success(`Пользователь замучен на ${Fe} ч.`),ye(!1),O(t.id)}catch(s){h.error(s.message||"Ошибка мута")}},Ss=async()=>{if(t)try{await k.unmute(t.id),h.success("Мут снят"),O(t.id)}catch(s){h.error(s.message||"Ошибка размута")}},As=async()=>{if(t)try{await k.ban(t.id,Re),h.success(`Пользователь отправлен в Азкабан на ${Re} ч.`),be(!1),O(t.id)}catch(s){h.error(s.message||"Ошибка отправки в Азкабан")}},Ps=async()=>{if(t)try{await k.unban(t.id),h.success("Пользователь освобожден из Азкабана"),O(t.id)}catch(s){h.error(s.message||"Ошибка освобождения")}},Ye=async s=>{try{await k.sendFriendRequest(s),F(a=>({...a,[s]:!0})),h.success("Запрос в друзья отправлен"),await S(),p&&ce(),ke&&O(s)}catch(a){console.error("Ошибка отправки запроса:",a),h.error(a.message||"Не удалось отправить запрос")}},Qe=async s=>{try{const a=await Ks.create(s);g&&g(a)}catch(a){h.error("Не удалось открыть чат: "+a.message)}},Xe=async s=>{try{await k.removeFriend(s),F(a=>{const x={...a};return delete x[s],x}),h.success("Пользователь удален из друзей"),W(!1),await S(),p&&ce(),ke&&O(s)}catch(a){console.error("Ошибка удаления из друзей:",a),h.error(a.message||"Не удалось удалить из друзей")}},Ie=s=>n?.friends?.includes(s)||!1,Us=async s=>{if(Ee(s),s.length<2){ne([]);return}try{const x=(await k.search(s)).users||[];ne(x.filter(L=>L.id!==n?.id))}catch(a){console.error("Ошибка поиска:",a),ne([])}},Ae=()=>$e?Object.values($e.achievements).filter(a=>a.isUnlocked&&a.unlockedAt).sort((a,x)=>new Date(x.unlockedAt).getTime()-new Date(a.unlockedAt).getTime()).slice(0,5).map(a=>ze.find(L=>L.id===a.achievementId)).filter(Boolean):[],Ds=async s=>{const a=s.target.files?.[0];if(a){if(!a.type.startsWith("image/")){h.error("Можно загружать только изображения");return}if(a.size>5*1024*1024){h.error("Файл слишком большой. Максимальный размер: 5 МБ");return}try{B(!0);const x=await Qs(a,512,512,.85);await k.uploadAvatar(x),h.success("Аватар успешно обновлен!"),await S()}catch(x){console.error("Avatar upload error:",x),h.error(x.message||"Ошибка загрузки аватара")}finally{B(!1),ve.current&&(ve.current.value="")}}},Pe=s=>{gs(s),ge(!0)},Es=()=>{Ne(!1),ve.current?.click()};if(ke&&t){const s=Ge;return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"border-b p-4 flex items-center gap-3",children:[d&&e.jsx(j,{variant:"ghost",size:"icon",onClick:d,children:e.jsx(ss,{className:"w-5 h-5"})}),e.jsx("h2",{className:"text-xl",children:"Профиль пользователя"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsx(M,{children:e.jsxs(R,{className:"pt-6",children:[e.jsxs("div",{className:"flex flex-col items-center gap-2 pb-4 mb-6 border-b",children:[e.jsx("div",{className:`w-32 h-32 rounded-full bg-primary/10 flex items-center justify-center overflow-hidden ${t.avatar?"cursor-pointer hover:opacity-80 transition-opacity":""}`,onClick:()=>{t.avatar&&Pe(he(t.avatar))},title:t.avatar?"Нажмите для просмотра":"",children:t.avatar?e.jsx("img",{src:he(t.avatar),alt:t.username,className:"w-full h-full object-cover",onError:a=>console.error("Avatar load error:",a)}):e.jsx(H,{className:"w-16 h-16"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-2xl mb-2",children:t.display_name||t.username}),t.display_name&&e.jsxs("p",{className:"text-sm text-muted-foreground mb-2",children:["@",t.username]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[e.jsxs(_,{variant:"outline",className:"flex items-center gap-1",children:[Ce(t.role),Se(t.role)]}),(()=>{const a=t.last_activity;if(!a)return null;const x=new Date(a).getTime(),P=new Date().getTime()-x;if(P<180*1e3)return e.jsx(_,{variant:"default",className:"bg-green-500",children:"Онлайн"});const U=Math.floor(P/(60*1e3)),oe=Math.floor(P/(3600*1e3)),Je=Math.floor(P/(1440*60*1e3));let de="";return Je>0?de=`${Je} д`:oe>0?de=`${oe} ч`:U>0?de=`${U} мин`:de="только что",e.jsx(_,{variant:"outline",children:de})})()]}),Ae().length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"flex items-center justify-center gap-2 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>we(!0),title:"Нажмите, чтобы увидеть все достижения",children:Ae().map(a=>e.jsx("div",{className:"text-2xl",title:a.name,children:a.icon},a.id))}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Последние достижения (нажмите для просмотра всех)"})]}),s&&e.jsx("p",{className:"text-sm text-muted-foreground",children:t.email})]})]}),t.banned&&e.jsx("div",{className:"p-4 bg-destructive/10 border border-destructive rounded mb-4",children:e.jsxs("p",{className:"text-destructive flex items-center gap-2",children:[e.jsx(_e,{className:"w-4 h-4"}),"Этот пользователь заблокирован"]})}),t.muted&&e.jsx("div",{className:"p-4 bg-warning/10 border border-warning rounded mb-4",children:e.jsxs("p",{className:"text-warning flex items-center gap-2",children:[e.jsx(as,{className:"w-4 h-4"}),"Этот пользователь в муте"]})}),(t.gender||t.age||t.interests)&&e.jsxs("div",{className:"p-4 bg-muted/30 rounded mb-4 space-y-2",children:[t.gender&&t.privacySettings?.showGender&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Пол"}),e.jsx("p",{children:t.gender==="male"?"Мужской":t.gender==="female"?"Женский":"Другой"})]}),t.age&&t.privacySettings?.showAge&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Возраст"}),e.jsxs("p",{children:[t.age," лет"]})]}),t.interests&&t.privacySettings?.showInterests&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Интересы"}),e.jsx("p",{children:t.interests})]})]}),Ge&&t.id!==n?.id&&e.jsxs("div",{className:"space-y-3 mb-4 p-4 bg-muted/30 rounded",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Управление пользователем"}),t.muted?e.jsxs(j,{variant:"outline",onClick:Ss,disabled:!ae&&t.role==="admin",className:"w-full justify-start",children:[e.jsx(Ys,{className:"w-4 h-4 mr-2"}),"Размутить"]}):e.jsxs(j,{variant:"outline",onClick:()=>ye(!0),disabled:!ae&&t.role==="admin",className:"w-full justify-start",children:[e.jsx(as,{className:"w-4 h-4 mr-2"}),"Мут"]}),t.banned?e.jsxs(j,{variant:"outline",onClick:Ps,disabled:!ae&&t.role==="admin",className:"w-full justify-start",children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"Освободить из Азкабана"]}):e.jsxs(j,{variant:"outline",onClick:()=>be(!0),disabled:t.role==="vip"||!ae&&t.role==="admin",className:"w-full justify-start",children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"Азкабан"]}),ae&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"Изменить роль"}),e.jsxs(hs,{value:t.role,onValueChange:a=>ks(t.id,a),disabled:t.username==="iBro",children:[e.jsx(us,{children:e.jsx(xs,{})}),e.jsxs(fs,{children:[e.jsx(V,{value:"user",children:"Пользователь"}),e.jsx(V,{value:"vip",children:"VIP"}),e.jsx(V,{value:"moderator",children:"Модератор"}),e.jsx(V,{value:"admin",children:"Администратор"})]})]}),t.username==="iBro"&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Роль первого пользователя нельзя изменить"})]})]}),e.jsxs("div",{className:"space-y-2",children:[Ie(t.id)?e.jsxs(j,{variant:"outline",onClick:()=>W(!0),className:"w-full",children:[e.jsx(ts,{className:"w-4 h-4 mr-2"}),"Удалить из друзей"]}):Z[t.id]?e.jsxs(j,{disabled:!0,variant:"outline",className:"w-full",children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Запрос отправлен"]}):e.jsxs(j,{onClick:()=>Ye(t.id),className:"w-full",disabled:Z[t.id],children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Добавить в друзья"]}),e.jsxs(j,{variant:"secondary",onClick:()=>Qe(t.id),className:"w-full",children:[e.jsx(rs,{className:"w-4 h-4 mr-2"}),"Написать"]})]})]})})}),e.jsx(T,{open:ps,onOpenChange:ye,children:e.jsxs(z,{children:[e.jsx($,{children:e.jsx(q,{children:"Мут пользователя"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"Время мута (часов)"}),e.jsx(I,{type:"number",min:"1",max:"24",value:Fe,onChange:a=>Ns(Math.min(24,Math.max(1,parseInt(a.target.value)||1)))}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Максимум: 24 часа. Пользователь сможет читать сообщения, но не сможет отправлять."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{variant:"outline",onClick:()=>ye(!1),className:"flex-1",children:"Отмена"}),e.jsx(j,{onClick:Cs,className:"flex-1",children:"Применить мут"})]})]})]})}),e.jsx(T,{open:ws,onOpenChange:be,children:e.jsxs(z,{children:[e.jsx($,{children:e.jsx(q,{children:"Отправить в Азкабан"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Пользователь будет отправлен в специальную комнату Азкабан и не сможет её покинуть до окончания срока наказания. Видеть эту комнату могут только администраторы и модераторы."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"Время бана (часов)"}),e.jsx(I,{type:"number",min:"1",max:"24",value:Re,onChange:a=>ys(Math.min(24,Math.max(1,parseInt(a.target.value)||1)))}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Максимум: 24 часа. Пользователь не сможет покинуть Азкабан и видеть другие комнаты."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{variant:"outline",onClick:()=>be(!1),className:"flex-1",children:"Отмена"}),e.jsx(j,{variant:"destructive",onClick:As,className:"flex-1",children:"В Азкабан"})]})]})]})}),e.jsx(T,{open:Ve,onOpenChange:a=>{W(a),a||ie(null)},children:e.jsxs(z,{children:[e.jsx($,{children:e.jsx(q,{children:"Удалить из друзей?"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Вы уверены, что хотите удалить ",(()=>{const a=se?r.find(x=>x.id===se):t;return a?.display_name||a?.username||"этого пользователя"})()," из друзей? После удаления вам нужно будет снова отправить запрос в друзья для восстановления."]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{variant:"outline",onClick:()=>{W(!1),ie(null)},className:"flex-1",children:"Отмена"}),e.jsx(j,{variant:"destructive",onClick:()=>{const a=se||t?.id;a&&Xe(a)},className:"flex-1",children:"Удалить"})]})]})]})}),e.jsx(T,{open:Me,onOpenChange:ge,children:e.jsxs(z,{className:"max-w-2xl",children:[e.jsx($,{children:e.jsx(q,{children:"Просмотр аватара"})}),e.jsx("div",{className:"flex items-center justify-center p-4",children:ee&&e.jsx("img",{src:ee,alt:"Avatar",className:"max-w-full max-h-[70vh] rounded-lg object-contain"})})]})}),e.jsx(T,{open:Be,onOpenChange:we,children:e.jsxs(z,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsx($,{children:e.jsx(q,{children:"Достижения пользователя"})}),e.jsx("div",{className:"py-4",children:e.jsx(Oe,{userId:t.id})})]})})]})}return p?e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"sticky top-0 z-30 bg-background border-b p-4",children:e.jsx("h2",{className:"text-xl",children:"Друзья и Уведомления"})}),e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-4 p-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"w-4 h-4"}),e.jsx("h4",{className:"font-semibold",children:"Уведомления"}),A>0&&e.jsx(_,{variant:"destructive",className:"ml-1 px-1.5 py-0 text-xs",children:A})]}),e.jsx(Zs,{onClose:()=>{},onFriendRequestHandled:()=>{ce(),Le()}})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(b,{htmlFor:"search",children:"Поиск пользователей"}),e.jsx(I,{id:"search",type:"text",placeholder:"Введите имя пользователя...",value:G,onChange:s=>Us(s.target.value)})]}),G.length>=2&&le.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold",children:"Результаты поиска"}),le.map(s=>e.jsx(M,{children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center overflow-hidden ${s.avatar?"cursor-pointer hover:opacity-80 transition-opacity":""}`,onClick:a=>{a.stopPropagation(),s.avatar&&Pe(s.avatar)},title:s.avatar?"Нажмите для просмотра":"",children:s.avatar?e.jsx("img",{src:s.avatar,alt:s.username,className:"w-full h-full object-cover"}):e.jsx(H,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0 cursor-pointer",onClick:()=>f&&f(s.id),children:[e.jsx("p",{className:"mb-1",children:s.display_name||s.username}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["@",s.username]}),e.jsxs(_,{variant:"outline",className:"flex items-center gap-1 w-fit mt-1",children:[Ce(s.role),Se(s.role)]})]}),!Ie(s.id)&&!Z[s.id]?e.jsx(j,{size:"sm",variant:"secondary",onClick:()=>Ye(s.id),disabled:Z[s.id],children:e.jsx(xe,{className:"w-4 h-4"})}):Ie(s.id)?e.jsx(_,{variant:"default",children:"Друг"}):e.jsxs(j,{size:"sm",variant:"outline",disabled:!0,children:[e.jsx(xe,{className:"w-4 h-4 mr-1"}),"Отправлен"]})]})})},s.id))]}),G.length>=2&&le.length===0&&e.jsx(M,{children:e.jsx(R,{className:"py-4 text-center text-muted-foreground text-sm",children:"Пользователи не найдены"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold",children:"Мои друзья"}),r.length===0?e.jsx(M,{children:e.jsx(R,{className:"py-8 text-center text-muted-foreground",children:"У вас пока нет друзей. Найдите пользователей через поиск и добавьте их!"})}):r.map(s=>e.jsx(M,{className:"cursor-pointer hover:bg-accent transition-colors",children:e.jsxs(R,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center overflow-hidden ${s.avatar?"cursor-pointer hover:opacity-80 transition-opacity":""}`,onClick:a=>{a.stopPropagation(),s.avatar&&Pe(s.avatar)},title:s.avatar?"Нажмите для просмотра":"",children:s.avatar?e.jsx("img",{src:he(s.avatar),alt:s.username,className:"w-full h-full object-cover",onError:a=>console.error("Friend avatar load error:",a)}):e.jsx(H,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0 cursor-pointer",onClick:()=>f&&f(s.id),children:[e.jsx("p",{className:"mb-1",children:s.display_name||s.username}),s.display_name&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["@",s.username]}),e.jsxs("div",{className:"flex items-center gap-2 mb-1 flex-wrap",children:[e.jsxs(_,{variant:"outline",className:"flex items-center gap-1",children:[Ce(s.role),Se(s.role)]}),(()=>{const a=s.last_activity;return a&&new Date().getTime()-new Date(a).getTime()<300*1e3?e.jsx(_,{variant:"default",className:"text-xs",children:"онлайн"}):null})()]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(j,{size:"sm",variant:"secondary",onClick:a=>{a.stopPropagation(),Qe(s.id)},className:"flex-1",children:[e.jsx(rs,{className:"w-4 h-4 mr-1"}),"Написать"]}),e.jsx(j,{size:"sm",variant:"outline",onClick:a=>{a.stopPropagation(),ie(s.id),W(!0)},children:e.jsx(ts,{className:"w-4 h-4"})})]})]})},s.id))]})]}),e.jsx(T,{open:Me,onOpenChange:ge,children:e.jsxs(z,{className:"max-w-2xl",children:[e.jsx($,{children:e.jsx(q,{children:"Просмотр аватара"})}),e.jsx("div",{className:"flex items-center justify-center p-4",children:ee&&e.jsx("img",{src:ee,alt:"Avatar",className:"max-w-full max-h-[70vh] rounded-lg object-contain"})})]})}),e.jsx(T,{open:Ve,onOpenChange:s=>{W(s),s||ie(null)},children:e.jsxs(z,{children:[e.jsx($,{children:e.jsx(q,{children:"Удалить из друзей?"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Вы уверены, что хотите удалить ",(()=>{const s=r.find(a=>a.id===se);return s?.display_name||s?.username||"этого пользователя"})()," из друзей? После удаления вам нужно будет снова отправить запрос в друзья для восстановления."]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{variant:"outline",onClick:()=>{W(!1),ie(null)},className:"flex-1",children:"Отмена"}),e.jsx(j,{variant:"destructive",onClick:()=>{se&&Xe(se)},className:"flex-1",children:"Удалить"})]})]})]})})]}):e.jsxs("div",{className:"h-full flex flex-col",children:[d&&e.jsxs("div",{className:"border-b p-4 flex items-center gap-3",children:[e.jsx(j,{variant:"ghost",size:"icon",onClick:d,children:e.jsx(ss,{className:"w-5 h-5"})}),e.jsx("h2",{className:"text-xl",children:"Мой профиль"})]}),e.jsxs(os,{value:De,onValueChange:je,className:"h-full flex flex-col",children:[e.jsxs(ds,{className:"w-full grid grid-cols-3",children:[e.jsxs(Y,{value:"profile",children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Профиль"]}),e.jsxs(Y,{value:"achievements",children:[e.jsx(Gs,{className:"w-4 h-4 mr-2"}),"Ачивки"]}),e.jsxs(Y,{value:"settings",children:[e.jsx(cs,{className:"w-4 h-4 mr-2"}),"Настройки"]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsxs(Q,{value:"profile",className:"m-0 p-6 space-y-6",children:[e.jsx(M,{children:e.jsx(X,{children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-32 h-32 rounded-full bg-primary/10 flex items-center justify-center overflow-hidden cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>Ne(!pe),children:n.avatar?e.jsx("img",{src:he(n.avatar),alt:n.username,className:"w-full h-full object-cover",onError:s=>console.error("Avatar load error:",s)}):e.jsx(H,{className:"w-16 h-16"})}),pe&&e.jsxs("div",{className:"absolute top-full mt-2 left-1/2 -translate-x-1/2 bg-background border rounded-lg shadow-lg z-50 min-w-[150px] overflow-hidden",children:[n.avatar&&e.jsxs("button",{onClick:()=>{Ne(!1),Pe(he(n.avatar))},className:"w-full px-4 py-2 text-left hover:bg-accent transition-colors flex items-center gap-2",children:[e.jsx(ls,{className:"w-4 h-4"}),"Просмотреть"]}),e.jsx("button",{onClick:Es,disabled:m,className:"w-full px-4 py-2 text-left hover:bg-accent transition-colors flex items-center gap-2 disabled:opacity-50",children:m?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}),"Загрузка..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ws,{className:"w-4 h-4"}),"Изменить"]})})]}),e.jsx("input",{ref:ve,type:"file",accept:"image/*",className:"hidden",onChange:Ds})]}),e.jsxs("div",{className:"text-center",children:[e.jsx(J,{className:"text-2xl mb-2",children:n?.display_name||n?.username}),n?.display_name&&e.jsxs("p",{className:"text-sm text-muted-foreground mb-2",children:["@",n?.username]}),e.jsx(te,{children:n?.email})]}),e.jsxs(_,{variant:"outline",className:"flex items-center gap-2",children:[Ce(n.role),Se(n.role)]}),Ae().length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"flex items-center justify-center gap-2 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>we(!0),title:"Нажмите, чтобы увидеть все достижения",children:Ae().map(s=>e.jsx("div",{className:"text-2xl",title:s.name,children:s.icon},s.id))}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Последние достижения (нажмите для просмотра всех)"})]})]})})}),(n?.gender||n?.age||n?.interests)&&e.jsxs(M,{children:[e.jsx(X,{children:e.jsx(J,{children:"Дополнительная информация"})}),e.jsxs(R,{className:"space-y-3",children:[n?.gender&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Пол"}),e.jsx("p",{children:n.gender==="male"?"Мужской":n.gender==="female"?"Женский":"Другой"})]}),n?.age&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Возраст"}),e.jsxs("p",{children:[n.age," лет"]})]}),n?.interests&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Интересы"}),e.jsx("p",{children:n.interests})]})]})]}),bs&&e.jsxs(M,{children:[e.jsxs(X,{children:[e.jsxs(J,{className:"flex items-center gap-2",children:[e.jsx(ls,{className:"w-5 h-5"}),'Режим "Глаз Бога"']}),e.jsx(te,{children:"Просмотр всех комнат в режиме наблюдения"})]}),e.jsx(R,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(b,{htmlFor:"god-mode",children:"Включить режим наблюдения"}),e.jsx(Xs,{id:"god-mode",checked:E,onCheckedChange:y})]})})]}),e.jsx(M,{children:e.jsx(R,{className:"pt-6",children:e.jsx(j,{variant:"destructive",onClick:D,className:"w-full",children:"Выйти из аккаунта"})})})]}),e.jsx(Q,{value:"achievements",className:"m-0 p-6",children:e.jsx(Oe,{userId:n.id})}),e.jsx(Q,{value:"settings",className:"m-0 h-full",children:e.jsx(Js,{})})]})]}),e.jsx(T,{open:Me,onOpenChange:ge,children:e.jsxs(z,{className:"max-w-2xl",children:[e.jsx($,{children:e.jsx(q,{children:"Просмотр аватара"})}),e.jsx("div",{className:"flex items-center justify-center p-4",children:ee&&e.jsx("img",{src:ee,alt:"Avatar",className:"max-w-full max-h-[70vh] rounded-lg object-contain"})})]})}),n&&e.jsx(T,{open:Be,onOpenChange:we,children:e.jsxs(z,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsx($,{children:e.jsx(q,{children:"Мои достижения"})}),e.jsx("div",{className:"py-4",children:e.jsx(Oe,{userId:n.id})})]})})]})}export{fa as UserProfile};
