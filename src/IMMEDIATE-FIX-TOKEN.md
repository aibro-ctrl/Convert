# ‚ö° –ù–ï–ú–ï–î–õ–ï–ù–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ò—Å—Ç–µ–∫—à–∏–π —Ç–æ–∫–µ–Ω

## üî¥ –£ –≤–∞—Å —Å–µ–π—á–∞—Å –∏—Å—Ç–µ–∫—à–∏–π —Ç–æ–∫–µ–Ω –≤ –±—Ä–∞—É–∑–µ—Ä–µ

### ‚úÖ –ß–¢–û –ù–£–ñ–ù–û –°–î–ï–õ–ê–¢–¨ –ü–†–Ø–ú–û –°–ï–ô–ß–ê–°:

```
1. –ù–∞–∂–º–∏—Ç–µ F5 (–∏–ª–∏ Ctrl+R / ‚åò+R)
2. –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—Å—è
3. –ò—Å—Ç–µ–∫—à–∏–π —Ç–æ–∫–µ–Ω –±—É–¥–µ—Ç —É–¥–∞–ª—ë–Ω –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò
4. –í—ã —É–≤–∏–¥–∏—Ç–µ —ç–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞
5. –í–æ–π–¥–∏—Ç–µ –∑–∞–Ω–æ–≤–æ
```

## üéØ –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### ‚ú® –ù–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤:

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**
   - –¢–æ–∫–µ–Ω –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –î–û –æ—Ç–ø—Ä–∞–≤–∫–∏ –ª—é–±—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
   - –ò—Å—Ç–µ–∫—à–∏–µ —Ç–æ–∫–µ–Ω—ã —É–¥–∞–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
   
2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º API –∑–∞–ø—Ä–æ—Å–æ–º**
   - –¢–æ–∫–µ–Ω –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Å 60-—Å–µ–∫—É–Ω–¥–Ω—ã–º –±—É—Ñ–µ—Ä–æ–º
   - –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ—á—Ç–∏ –∏—Å—Ç–µ–∫—à–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤

3. **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã** (`/utils/tokenUtils.ts`)
   - `isTokenExpired()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è
   - `clearStoragePreservingSettings()` - –æ—á–∏—Å—Ç–∫–∞ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Ç–µ–º—ã
   - `validateAndCleanToken()` - –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ

4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π logout –ø—Ä–∏ 401**
   - –ü—Ä–∏ –æ—à–∏–±–∫–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Ç–æ–∫–µ–Ω —É–¥–∞–ª—è–µ—Ç—Å—è
   - –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

## üìã –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ü–æ—Ä—è–¥–æ–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏:

```
App.tsx (–∑–∞–ø—É—Å–∫)
    ‚Üì
validateAndCleanToken() ‚Üê –ù–û–í–û–ï! –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    ‚Üì
AuthContext.checkAuth()
    ‚Üì
isTokenExpired() ‚Üê –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
    ‚Üì
API Request
    ‚Üì
fetchAPI() ‚Üê –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
    ‚Üì
Server validation
    ‚Üì
401 Error? ‚Üí clearStorage() + reload
```

### –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:

‚úÖ **–§–æ—Ä–º–∞—Ç JWT** (3 —á–∞—Å—Ç–∏, —Ä–∞–∑–¥–µ–ª—ë–Ω–Ω—ã–µ —Ç–æ—á–∫–æ–π)  
‚úÖ **–ù–∞–ª–∏—á–∏–µ sub claim** (ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)  
‚úÖ **–í—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è** (exp claim)  
‚úÖ **–ë—É—Ñ–µ—Ä 60 —Å–µ–∫—É–Ω–¥** (–ø—Ä–µ–¥—É–ø—Ä–µ–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞)  

## üîß –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

- `/utils/tokenUtils.ts` - –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–æ–∫–µ–Ω–∞–º–∏
- `/IMMEDIATE-FIX-TOKEN.md` - –≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç
- –û–±–Ω–æ–≤–ª–µ–Ω—ã: `App.tsx`, `AuthContext.tsx`, `utils/api.ts`

## üé® –ß—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è:

–ü—Ä–∏ –æ—á–∏—Å—Ç–∫–µ —Ç–æ–∫–µ–Ω–∞ **–í–°–ï–ì–î–ê** —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è:
- ‚úÖ –¢–µ–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è (—Ç—ë–º–Ω–∞—è/—Å–≤–µ—Ç–ª–∞—è)
- ‚úÖ –î—Ä—É–≥–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

## ‚ö†Ô∏è –ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ?

JWT —Ç–æ–∫–µ–Ω—ã –∏–º–µ—é—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è (–æ–±—ã—á–Ω–æ 1 —á–∞—Å).
–†–∞–Ω—å—à–µ –∏—Å—Ç–µ–∫—à–∏–µ —Ç–æ–∫–µ–Ω—ã –Ω–µ —É–¥–∞–ª—è–ª–∏—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

**–¢–µ–ø–µ—Ä—å —ç—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ!** üéâ

## üöÄ –ë–æ–ª—å—à–µ –Ω–µ –±—É–¥–µ—Ç –ø—Ä–æ–±–ª–µ–º:

- ‚ùå –ù–µ—Ç –∑–∞–≤–∏—Å–∞–Ω–∏–π —Å –∏—Å—Ç–µ–∫—à–∏–º–∏ —Ç–æ–∫–µ–Ω–∞–º–∏
- ‚ùå –ù–µ—Ç —Ä—É—á–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏ localStorage
- ‚ùå –ù–µ—Ç –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –æ—à–∏–±–æ–∫
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞–º–∏
- ‚úÖ –ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —ç–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 2025-11-01  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã

## üìû –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–µ–Ω–∞:

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –≤—Ä—É—á–Ω—É—é
```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (F12):
localStorage.clear();
location.reload();
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞
```javascript
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Ç–æ–∫–µ–Ω:
const token = localStorage.getItem('access_token');
if (token) {
  const payload = JSON.parse(atob(token.split('.')[1]));
  console.log('–ò—Å—Ç–µ–∫–∞–µ—Ç:', new Date(payload.exp * 1000));
  console.log('–ò—Å—Ç—ë–∫?', payload.exp * 1000 < Date.now());
}
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: DevPanel
–û—Ç–∫—Ä–æ–π—Ç–µ DevPanel –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ ‚Üí "üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å localStorage"

---

**–ü—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5) - –≤—Å—ë –∏—Å–ø—Ä–∞–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏! üîÑ**
