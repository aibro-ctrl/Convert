# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ - –†–µ–∑—é–º–µ

## –î–∞—Ç–∞: 2025-11-01

### 1. ‚ùå –û—à–∏–±–∫–∞: "Failed to fetch" (–°–µ—Ç—å)

**–ü—Ä–æ–±–ª–µ–º–∞:** Frontend –Ω–µ –º–æ–≥ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É
**–ü—Ä–∏—á–∏–Ω–∞:** –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è storage –∏ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∫–æ–º–Ω–∞—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∞ –∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
**–†–µ—à–µ–Ω–∏–µ:**
- –ü–µ—Ä–µ–º–µ—Å—Ç–∏–ª–∏ `storage.initializeStorage()` –∏ `initializeSystemRooms()` –≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã –ü–û–°–õ–ï –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
- –î–æ–±–∞–≤–∏–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ —Å `.catch()` –¥–ª—è –æ–±–æ–∏—Ö –≤—ã–∑–æ–≤–æ–≤
- –¢–µ–ø–µ—Ä—å —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ, –∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ —Ñ–æ–Ω–µ

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:**
- `/supabase/functions/server/index.tsx` (—Å—Ç—Ä–æ–∫–∏ 2218-2227)

---

### 2. ‚ùå –û—à–∏–±–∫–∞: "StorageApiError: The resource already exists" (409)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–µ—Ä–∞ –ø–æ—è–≤–ª—è–ª–∞—Å—å –æ—à–∏–±–∫–∞ –æ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º storage bucket
**–ü—Ä–∏—á–∏–Ω–∞:** Race condition - bucket –ø—Ä–æ–≤–µ—Ä—è–ª—Å—è –Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ, –Ω–æ –º–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∏ —Å–æ–∑–¥–∞–Ω–∏–µ–º –º–æ–≥ –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω
**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ –æ—à–∏–±–∫–∏ `409` (Conflict)
- –¢–µ–ø–µ—Ä—å –æ—à–∏–±–∫–∞ "already exists" –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ –æ–∂–∏–¥–∞–µ–º–∞—è
- –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ "race condition handled" –≤–º–µ—Å—Ç–æ –æ—à–∏–±–∫–∏

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:**
- `/supabase/functions/server/storage.tsx` (—Å—Ç—Ä–æ–∫–∏ 11-35)

---

### 3. ‚ùå –û—à–∏–±–∫–∞: "AuthApiError: Invalid login credentials" –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º email –ø–æ—è–≤–ª—è–ª–∞—Å—å –æ—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
**–ü—Ä–∏—á–∏–Ω–∞:** –ö–æ–¥ –ø—ã—Ç–∞–ª—Å—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä–æ–ª—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ signIn
**–†–µ—à–µ–Ω–∏–µ:**
- –£–±—Ä–∞–Ω–∞ –ø–æ–ø—ã—Ç–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞—Ä–æ–ª—è –≤ —Ñ—É–Ω–∫—Ü–∏–∏ signup
- –¢–µ–ø–µ—Ä—å –ø—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –≤–æ–π–¥–∏—Ç–µ"
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è Auth –∏ KV –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –≤—Ö–æ–¥–µ, –∞ –Ω–µ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:**
- `/supabase/functions/server/auth.tsx` (—Å—Ç—Ä–æ–∫–∏ 72-87)

---

## –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞

‚úÖ **–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**
- –í—Å–µ endpoints –¥–æ—Å—Ç—É–ø–Ω—ã
- CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

‚úÖ **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è**
- Storage buckets —Å–æ–∑–¥–∞—é—Ç—Å—è/–ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
- –°–∏—Å—Ç–µ–º–Ω—ã–µ –∫–æ–º–Ω–∞—Ç—ã (–ê–∑–∫–∞–±–∞–Ω) —Å–æ–∑–¥–∞—é—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
- –û—à–∏–±–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç —Å–µ—Ä–≤–µ—Ä

‚úÖ **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –í—Ö–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –ü–µ—Ä–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (iBro) —Å–æ–∑–¥–∞–µ—Ç—Å—è –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ email —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

---

## –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–µ—Ä–∞:**
   ```
   GET https://xldmtsnzqyqhuhhkwwcx.supabase.co/functions/v1/make-server-b0f1e6d5/health
   ```
   –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å `{"status":"ok", ...}`

2. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (iBro):**
   - Email: –ª—é–±–æ–π
   - Username: –ª—é–±–æ–π (–±—É–¥–µ—Ç –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ "iBro")
   - Password: –ª—é–±–æ–π
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∏—Ç —Ä–æ–ª—å `admin`

3. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:**
   - –ë—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã —Å —Ä–æ–ª—å—é `user`
   - –ú–æ–≥—É—Ç –±—ã—Ç—å –ø–æ–≤—ã—à–µ–Ω—ã –¥–æ `moderator`, `vip` –∏–ª–∏ `admin` –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º

---

## –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏

‚ö†Ô∏è **–ü–µ—Ä–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (iBro):**
- –°–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- –í—Å–µ–≥–¥–∞ –∏–º–µ–µ—Ç —Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- –†–æ–ª—å –Ω–µ–ª—å–∑—è –∏–∑–º–µ–Ω–∏—Ç—å —á–µ—Ä–µ–∑ UI
- –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π, –∫—Ç–æ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∂–∏–º "–ì–ª–∞–∑ –ë–æ–≥–∞"

‚ö†Ô∏è **Storage Buckets:**
- –°–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
- –ï—Å–ª–∏ bucket —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –æ—à–∏–±–∫–∞ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è
- –°–ø–∏—Å–æ–∫ buckets: `make-b0f1e6d5-uploads`, `make-b0f1e6d5-voice`, `make-b0f1e6d5-video`, `make-b0f1e6d5-images`, `make-b0f1e6d5-avatars`

‚ö†Ô∏è **–°–∏—Å—Ç–µ–º–Ω—ã–µ –∫–æ–º–Ω–∞—Ç—ã:**
- "üîí –ê–∑–∫–∞–±–∞–Ω" —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∑–∞–±–∞–Ω–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ù–µ —É–¥–∞–ª—è–µ—Ç—Å—è –ø—Ä–∏ `adminAPI.clearData()`
