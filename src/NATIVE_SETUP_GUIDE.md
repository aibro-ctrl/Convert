# üöÄ –ù–∞—Ç–∏–≤–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ Backend (–ë–ï–ó Docker)

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –î–ª—è Ubuntu —Å —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º–∏ PocketBase –∏ Redis:

```bash
cd backend-setup
chmod +x setup.sh
./setup.sh
```

**–ì–æ—Ç–æ–≤–æ!** –°–∫—Ä–∏–ø—Ç –≤—Å—ë –Ω–∞—Å—Ç—Ä–æ–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞ ~5 –º–∏–Ω—É—Ç.

---

## üìã –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç?

1. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç PocketBase –∏ Redis
2. ‚úÖ –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∫–ª—é—á–∏
3. ‚úÖ –°–æ–∑–¥–∞–µ—Ç .env –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
4. ‚úÖ –ó–∞–ø—É—Å–∫–∞–µ—Ç PocketBase (–µ—Å–ª–∏ –Ω–µ –∑–∞–ø—É—â–µ–Ω)
5. ‚úÖ –°–æ–∑–¥–∞–µ—Ç 7 –∫–æ–ª–ª–µ–∫—Ü–∏–π –≤ PocketBase
6. ‚úÖ –î–æ–±–∞–≤–ª—è–µ—Ç 8 –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
7. ‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç NPM –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
8. ‚úÖ –°–æ–∑–¥–∞–µ—Ç systemd —Å–µ—Ä–≤–∏—Å—ã
9. ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç Redis –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é
10. ‚úÖ –¢–µ—Å—Ç–∏—Ä—É–µ—Ç –≤—Å–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

---

## üõ†Ô∏è –ß—Ç–æ –Ω—É–∂–Ω–æ –î–û –∑–∞–ø—É—Å–∫–∞?

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ PocketBase (–µ—Å–ª–∏ –µ—â–µ –Ω–µ—Ç):

```bash
# –°–∫–∞—á–∞–π—Ç–µ
cd /tmp
wget https://github.com/pocketbase/pocketbase/releases/download/v0.22.0/pocketbase_0.22.0_linux_amd64.zip

# –†–∞—Å–ø–∞–∫—É–π—Ç–µ
sudo mkdir -p /opt/pocketbase
sudo unzip pocketbase_0.22.0_linux_amd64.zip -d /opt/pocketbase
sudo chmod +x /opt/pocketbase/pocketbase

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ
/opt/pocketbase/pocketbase --version
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Redis (–µ—Å–ª–∏ –µ—â–µ –Ω–µ—Ç):

```bash
sudo apt update
sudo apt install redis-server -y

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ
sudo systemctl enable redis-server
sudo systemctl start redis-server

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ
redis-cli ping
# –î–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å: PONG
```

### 3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Node.js 18+ (–µ—Å–ª–∏ –µ—â–µ –Ω–µ—Ç):

```bash
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install -y nodejs

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ
node --version
npm --version
```

---

## üìÅ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

```
backend-setup/
‚îú‚îÄ‚îÄ setup.sh               # –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ ‚≠ê
‚îú‚îÄ‚îÄ create-collections.js  # –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–π PocketBase
‚îú‚îÄ‚îÄ redis-cache.js         # Redis Cache Manager
‚îú‚îÄ‚îÄ test-connection.js     # –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
‚îî‚îÄ‚îÄ README.md             # –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

---

## üîß –°–æ–∑–¥–∞–Ω–Ω—ã–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤ PocketBase –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã:

1. **users** (auth) - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ + E2EE –∫–ª—é—á–∏
2. **rooms** - –∫–æ–º–Ω–∞—Ç—ã (–ø—É–±–ª–∏—á–Ω—ã–µ/–ø—Ä–∏–≤–∞—Ç–Ω—ã–µ/DM)
3. **messages** - —Å–æ–æ–±—â–µ–Ω–∏—è + —Ä–µ–∞–∫—Ü–∏–∏
4. **achievements** - –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
5. **user_achievements** - –ø—Ä–æ–≥—Ä–µ—Å—Å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
6. **friend_requests** - –∑–∞–ø—Ä–æ—Å—ã –¥—Ä—É–∂–±—ã
7. **files** - –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

---

## üéØ –ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

### –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:

1. –û—Ç–∫—Ä–æ–π—Ç–µ: http://localhost:8090/_/
2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É —Å–æ–∑–¥–∞–Ω–∏—è –∞–¥–º–∏–Ω–∞:
   - Email: `admin@konvert.chat`
   - Password: `–≤–∞—à_–±–µ–∑–æ–ø–∞—Å–Ω—ã–π_–ø–∞—Ä–æ–ª—å`

### –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É:

```bash
# –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
cd backend-setup
node test-connection.js

# –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å:
# ‚úì PocketBase: 5/5 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ
# ‚úì Redis: 5/5 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ
```

### –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:

```bash
cd /path/to/konvert-chat
npm run dev
```

–û—Ç–∫—Ä–æ–π—Ç–µ: http://localhost:3000

---

## üìä –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤

### –ü—Ä–æ–≤–µ—Ä–∫–∞:

```bash
# PocketBase
sudo systemctl status konvert-pocketbase

# Redis
sudo systemctl status redis-server
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
sudo systemctl restart konvert-pocketbase
sudo systemctl restart redis-server

# –õ–æ–≥–∏
sudo journalctl -u konvert-pocketbase -f
```

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–ª—é—á–∏:

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –≤ `.env`:

- `JWT_SECRET` - –¥–ª—è JWT —Ç–æ–∫–µ–Ω–æ–≤
- `ENCRYPTION_KEY` - –¥–ª—è E2EE —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è

**–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —ç—Ç–∏ –∫–ª—é—á–∏!** –û–Ω–∏ –Ω—É–∂–Ω—ã –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:

1. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ firewall:**
```bash
sudo ufw allow 8090/tcp  # PocketBase
sudo ufw allow 6379/tcp  # Redis (—Ç–æ–ª—å–∫–æ –¥–ª—è localhost)
sudo ufw enable
```

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ Nginx reverse proxy** (—Å–º. backend-setup/README.md)

3. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç:**
```bash
sudo certbot --nginx -d your-domain.com
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –†—É—á–Ω–æ–π —Ç–µ—Å—Ç:

```bash
# PocketBase health
curl http://localhost:8090/api/health

# Redis ping
redis-cli ping

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ Redis
redis-cli INFO stats
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç:

```bash
cd backend-setup
node test-connection.js
```

---

## üêõ Troubleshooting

### PocketBase –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–∞
sudo lsof -i :8090

# –£–±–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞ –ø–æ—Ä—Ç—É 8090
sudo kill -9 $(sudo lsof -t -i:8090)

# –ó–∞–ø—É—Å–∫ –≤—Ä—É—á–Ω—É—é
cd /opt/pocketbase
./pocketbase serve --http=0.0.0.0:8090
```

### Redis –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞
sudo systemctl status redis-server

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
sudo systemctl restart redis-server

# –¢–µ—Å—Ç
redis-cli -h localhost -p 6379 ping
```

### –û—à–∏–±–∫–∞ "Cannot find module 'pocketbase'":

–≠—Ç–∞ –æ—à–∏–±–∫–∞ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –µ—Å–ª–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã. –†–µ—à–µ–Ω–∏–µ:

```bash
# –í–∞—Ä–∏–∞–Ω—Ç 1: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤—Ä—É—á–Ω—É—é
cd backend-setup
chmod +x install-deps.sh
./install-deps.sh

# –í–∞—Ä–∏–∞–Ω—Ç 2: –ò–ª–∏ —á–µ—Ä–µ–∑ npm
cd backend-setup
npm install pocketbase ioredis dotenv

# –ó–∞—Ç–µ–º –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É
./setup.sh
```

### –ö–æ–ª–ª–µ–∫—Ü–∏–∏ –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è:

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å PocketBase
curl http://localhost:8090/api/health

# –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å –≤—Ä—É—á–Ω—É—é
cd backend-setup
node create-collections.js

# –ò–ª–∏ —á–µ—Ä–µ–∑ Admin UI
# http://localhost:8090/_/
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- **–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** [backend-setup/README.md](backend-setup/README.md)
- **Redis Cache API:** [backend-setup/redis-cache.js](backend-setup/redis-cache.js)
- **–ú–∏–≥—Ä–∞—Ü–∏—è –∏–∑ Docker:** –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è, —ç—Ç–æ –Ω–∞—Ç–∏–≤–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç

- [ ] PocketBase —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- [ ] Redis —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- [ ] Node.js 18+ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- [ ] –ó–∞–ø—É—â–µ–Ω `./setup.sh`
- [ ] –°–æ–∑–¥–∞–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –≤ PocketBase Admin UI
- [ ] –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø—Ä–æ–π–¥–µ–Ω (`node test-connection.js`)
- [ ] –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è (`npm run dev`)

---

## üéâ –ì–æ—Ç–æ–≤–æ!

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤ —É –≤–∞—Å –±—É–¥–µ—Ç:

‚úÖ PocketBase —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Å–∏—Å—Ç–µ–º–Ω—ã–π —Å–µ—Ä–≤–∏—Å  
‚úÖ Redis –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è  
‚úÖ 7 –∫–æ–ª–ª–µ–∫—Ü–∏–π —Å–æ–∑–¥–∞–Ω—ã  
‚úÖ 8 –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –¥–æ–±–∞–≤–ª–µ–Ω—ã  
‚úÖ E2EE —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–æ  
‚úÖ Real-time –ø–æ–¥–ø–∏—Å–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç  
‚úÖ Backend –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤!  

**–ó–∞–ø—É—Å—Ç–∏—Ç–µ frontend –∏ –Ω–∞—Å–ª–∞–∂–¥–∞–π—Ç–µ—Å—å —á–∞—Ç–æ–º! üöÄ**

---

**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:** Ubuntu 20.04+ (–Ω–∞—Ç–∏–≤–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞)  
**Docker:** –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è ‚ùå  
**–í—Ä–µ–º—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏:** ~5 –º–∏–Ω—É—Ç ‚ö°