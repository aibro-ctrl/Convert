# üîê –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è JWT —Ç–æ–∫–µ–Ω–∞–º–∏

## –û–±–∑–æ—Ä

–ü–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è JWT —Ç–æ–∫–µ–Ω–∞–º–∏ —Å –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–π –∑–∞—â–∏—Ç–æ–π –æ—Ç –∏—Å—Ç–µ—á–µ–Ω–∏—è –∏ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤.

---

## üéØ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

### 1. –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã (`/utils/tokenUtils.ts`)

#### `isTokenExpired(token, bufferSeconds)`
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∏—Å—Ç–µ—á–µ–Ω–∏–µ JWT —Ç–æ–∫–µ–Ω–∞:
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ JWT (3 —á–∞—Å—Ç–∏)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–≥–æ claim `sub`
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –∏—Å—Ç–µ—á–µ–Ω–∏—è `exp`
- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π –±—É—Ñ–µ—Ä (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 60 —Å–µ–∫)
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```typescript
if (isTokenExpired(token, 60)) {
  // –¢–æ–∫–µ–Ω –∏—Å—Ç–µ—á—ë—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ 60 —Å–µ–∫—É–Ω–¥
  clearToken();
}
```

#### `clearStoragePreservingSettings(preserveKeys)`
–û—á–∏—â–∞–µ—Ç localStorage —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤–∞–∂–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫:
- üé® –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–µ–º—É –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è
- üíæ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ UI
- üóëÔ∏è –£–¥–∞–ª—è–µ—Ç –≤—Å–µ —Ç–æ–∫–µ–Ω—ã –∏ –¥–∞–Ω–Ω—ã–µ
- üìù –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```typescript
clearStoragePreservingSettings(['app-theme', 'language']);
```

#### `validateAndCleanToken()`
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–∫–µ–Ω –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
- üöÄ –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –¥–æ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ React
- ‚ö° –£–¥–∞–ª—è–µ—Ç –∏—Å—Ç–µ–∫—à–∏–µ —Ç–æ–∫–µ–Ω—ã —Å—Ä–∞–∑—É
- üîç –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –Ω–µ–Ω—É–∂–Ω—ã–µ API –∑–∞–ø—Ä–æ—Å—ã

```typescript
// –í App.tsx –ø–µ—Ä–µ–¥ —ç–∫—Å–ø–æ—Ä—Ç–æ–º
validateAndCleanToken();
```

#### `getTokenInfo(token)`
–û—Ç–ª–∞–¥–æ—á–Ω–∞—è —É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –∏–Ω—Å–ø–µ–∫—Ü–∏–∏ —Ç–æ–∫–µ–Ω–∞:
- üìä –î–µ–∫–æ–¥–∏—Ä—É–µ—Ç payload
- ‚è∞ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è
- üë§ –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- üêõ –ü–æ–º–æ–≥–∞–µ—Ç –≤ –¥–µ–±–∞–≥–µ

---

## üõ°Ô∏è –£—Ä–æ–≤–Ω–∏ –∑–∞—â–∏—Ç—ã

### –£—Ä–æ–≤–µ–Ω—å 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
**–§–∞–π–ª:** `App.tsx`  
**–ú–æ–º–µ–Ω—Ç:** –î–æ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ React

```typescript
import { validateAndCleanToken } from './utils/tokenUtils';

// –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –º–æ–¥—É–ª—è
validateAndCleanToken();
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–∫–µ–Ω –≤ localStorage
- –£–¥–∞–ª—è–µ—Ç –µ—Å–ª–∏ –∏—Å—Ç—ë–∫
- –õ–æ–≥–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç

### –£—Ä–æ–≤–µ–Ω—å 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ AuthContext
**–§–∞–π–ª:** `contexts/AuthContext.tsx`  
**–ú–æ–º–µ–Ω—Ç:** –ü—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

```typescript
const checkAuth = async () => {
  const token = localStorage.getItem('access_token');
  
  if (token && isTokenExpired(token, 0)) {
    clearStoragePreservingSettings();
    setUser(null);
    return;
  }
  
  // ... –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –≤–∞–ª–∏–¥–Ω—ã–º —Ç–æ–∫–µ–Ω–æ–º
};
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–∫–µ–Ω –ø–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–æ–º `/auth/me`
- –ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –µ—Å–ª–∏ —Ç–æ–∫–µ–Ω –∏—Å—Ç—ë–∫
- –°—Ä–∞–∑—É –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —ç–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞

### –£—Ä–æ–≤–µ–Ω—å 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º API –∑–∞–ø—Ä–æ—Å–æ–º
**–§–∞–π–ª:** `utils/api.ts`  
**–ú–æ–º–µ–Ω—Ç:** –ü–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º fetch()

```typescript
async function fetchAPI(endpoint: string, options: RequestInit = {}) {
  let token = localStorage.getItem('access_token');
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å –±—É—Ñ–µ—Ä–æ–º 60 —Å–µ–∫—É–Ω–¥
  if (token && isTokenExpired(token, 60)) {
    clearStoragePreservingSettings();
    token = null; // –ò—Å–ø–æ–ª—å–∑—É–µ–º anon key –≤–º–µ—Å—Ç–æ –∏—Å—Ç–µ–∫—à–µ–≥–æ —Ç–æ–∫–µ–Ω–∞
  }
  
  // ... –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å
}
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–∫–µ–Ω —Å 60-—Å–µ–∫—É–Ω–¥–Ω—ã–º –±—É—Ñ–µ—Ä–æ–º
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ—á—Ç–∏ –∏—Å—Ç–µ–∫—à–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ anon key

### –£—Ä–æ–≤–µ–Ω—å 4: –û–±—Ä–∞–±–æ—Ç–∫–∞ 401 –æ—à–∏–±–æ–∫
**–§–∞–π–ª:** `utils/api.ts`  
**–ú–æ–º–µ–Ω—Ç:** –ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞

```typescript
if (response.status === 401) {
  if (token) {
    clearStoragePreservingSettings();
    setTimeout(() => window.location.reload(), 100);
  }
}
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç Unauthorized –æ—à–∏–±–∫–∏
- –û—á–∏—â–∞–µ—Ç –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π —Ç–æ–∫–µ–Ω
- –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –ø–æ–∫–∞–∑–∞ login

---

## üìä –ü–æ—Ç–æ–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞

```mermaid
graph TD
    A[–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è] --> B[validateAndCleanToken]
    B --> C{–¢–æ–∫–µ–Ω –≤–∞–ª–∏–¥–µ–Ω?}
    C -->|–î–∞| D[React —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥]
    C -->|–ù–µ—Ç| E[–û—á–∏—Å—Ç–∏—Ç—å localStorage]
    E --> D
    D --> F[AuthContext.checkAuth]
    F --> G{–¢–æ–∫–µ–Ω –≤–∞–ª–∏–¥–µ–Ω?}
    G -->|–î–∞| H[API –∑–∞–ø—Ä–æ—Å /auth/me]
    G -->|–ù–µ—Ç| I[–ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞]
    H --> J[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω]
    J --> K[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ–ª–∞–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ]
    K --> L[fetchAPI –ø—Ä–æ–≤–µ—Ä–∫–∞]
    L --> M{–¢–æ–∫–µ–Ω –∏—Å—Ç–µ–∫–∞–µ—Ç < 60 —Å–µ–∫?}
    M -->|–î–∞| N[–û—á–∏—Å—Ç–∏—Ç—å –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å anon]
    M -->|–ù–µ—Ç| O[–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω]
    N --> P[–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å]
    O --> P
    P --> Q{–°—Ç–∞—Ç—É—Å 401?}
    Q -->|–î–∞| R[–û—á–∏—Å—Ç–∏—Ç—å + reload]
    Q -->|–ù–µ—Ç| S[–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—Ç–≤–µ—Ç]
```

---

## üîÑ –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Ç–æ–∫–µ–Ω–∞

### 1. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
```
–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/–í—Ö–æ–¥
    ‚Üì
Supabase Auth –≤—ã–¥–∞—ë—Ç JWT
    ‚Üì
access_token ‚Üí localStorage
    ‚Üì
–¢–æ–∫–µ–Ω –≤–∞–ª–∏–¥–µ–Ω 1 —á–∞—Å
```

### 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
```
–ö–∞–∂–¥—ã–π API –∑–∞–ø—Ä–æ—Å:
    ‚Üì
–ü—Ä–æ–≤–µ—Ä–∫–∞ isTokenExpired()
    ‚Üì
–ï—Å–ª–∏ –≤–∞–ª–∏–¥–µ–Ω ‚Üí –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å
–ï—Å–ª–∏ –∏—Å—Ç—ë–∫ ‚Üí –æ—á–∏—Å—Ç–∏—Ç—å –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å anon
```

### 3. –ò—Å—Ç–µ—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
```
exp timestamp < now
    ‚Üì
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ
    ‚Üì
clearStoragePreservingSettings()
    ‚Üì
–ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞
```

### 4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ (–±—É–¥—É—â–µ–µ)
```
–¢–æ–∫–µ–Ω –±–ª–∏–∑–æ–∫ –∫ –∏—Å—Ç–µ—á–µ–Ω–∏—é
    ‚Üì
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π refresh (–µ—Å–ª–∏ –µ—Å—Ç—å refresh_token)
    ‚Üì
–ù–æ–≤—ã–π access_token ‚Üí localStorage
```

---

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ –≤ –ª—é–±–æ–º –º–µ—Å—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:

```typescript
import { isTokenExpired } from '../utils/tokenUtils';

const token = localStorage.getItem('access_token');
if (token && !isTokenExpired(token)) {
  // –¢–æ–∫–µ–Ω –≤–∞–ª–∏–¥–µ–Ω, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
  makeAuthenticatedRequest();
} else {
  // –¢–æ–∫–µ–Ω –∏—Å—Ç—ë–∫, –ø–æ–∫–∞–∑–∞—Ç—å login
  redirectToLogin();
}
```

### –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –Ω–∞—Å—Ç—Ä–æ–µ–∫:

```typescript
import { clearStoragePreservingSettings } from '../utils/tokenUtils';

// –û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë –∫—Ä–æ–º–µ —Ç–µ–º—ã
clearStoragePreservingSettings();

// –û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë –∫—Ä–æ–º–µ —Ç–µ–º—ã –∏ —è–∑—ã–∫–∞
clearStoragePreservingSettings(['app-theme', 'app-language']);
```

### –û—Ç–ª–∞–¥–∫–∞ —Ç–æ–∫–µ–Ω–∞:

```typescript
import { getTokenInfo } from '../utils/tokenUtils';

const token = localStorage.getItem('access_token');
if (token) {
  const info = getTokenInfo(token);
  console.log('Token info:', info);
  // {
  //   sub: "user-id",
  //   email: "user@example.com",
  //   expiresAt: "2025-11-01T15:30:00Z",
  //   expiresIn: "45 minutes",
  //   isExpired: false
  // }
}
```

---

## üé® –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫

–ü—Ä–∏ –ª—é–±–æ–π –æ—á–∏—Å—Ç–∫–µ —Ç–æ–∫–µ–Ω–∞ **–í–°–ï–ì–î–ê** —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è:

### –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é:
- `app-theme` - –¢—ë–º–Ω–∞—è/—Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞

### –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è:
```typescript
// –î–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–ª—é—á–∏ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
clearStoragePreservingSettings([
  'app-theme',
  'app-language',
  'ui-density',
  'notification-settings'
]);
```

---

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –í–∫–ª—é—á–∏—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:

–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç —Å–≤–æ–∏ –¥–µ–π—Å—Ç–≤–∏—è:

```
validateAndCleanToken: Checking token...
isTokenExpired: Token expired 15 minutes ago (at 2025-11-01T14:00:00Z)
clearStoragePreservingSettings: Clearing localStorage...
clearStoragePreservingSettings: Restored app-theme
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –≤ –∫–æ–Ω—Å–æ–ª–∏:

```javascript
// –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
const token = localStorage.getItem('access_token');
if (token) {
  const payload = JSON.parse(atob(token.split('.')[1]));
  console.log('Expires:', new Date(payload.exp * 1000));
  console.log('Is expired:', payload.exp * 1000 < Date.now());
}

// –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
import { getTokenInfo } from './utils/tokenUtils';
console.log(getTokenInfo(token));
```

---

## üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –º–µ—Ç—Ä–∏–∫–∏

### –í—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞:
- **validateAndCleanToken**: < 1ms (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞)
- **isTokenExpired**: < 1ms (–ø–∞—Ä—Å–∏–Ω–≥ JWT)
- **clearStoragePreservingSettings**: < 5ms (–æ—á–∏—Å—Ç–∫–∞ + –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ)

### –ß–∞—Å—Ç–æ—Ç–∞ –ø—Ä–æ–≤–µ—Ä–æ–∫:
- –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: **1 —Ä–∞–∑**
- –í AuthContext: **1 —Ä–∞–∑ –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏**
- –ü–µ—Ä–µ–¥ API –∑–∞–ø—Ä–æ—Å–∞–º–∏: **–∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å**
- –ü—Ä–∏ 401 –æ—à–∏–±–∫–µ: **–ø–æ —Å–æ–±—ã—Ç–∏—é**

---

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Å–∏—Å—Ç–µ–º—ã

1. **üîÑ –ü–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è** - –Ω–µ—Ç —Ä—É—á–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π
2. **üõ°Ô∏è –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –∑–∞—â–∏—Ç–∞** - 4 —É—Ä–æ–≤–Ω—è –ø—Ä–æ–≤–µ—Ä–∫–∏
3. **‚ö° –ü—Ä–æ–∞–∫—Ç–∏–≤–Ω–∞—è** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
4. **üíæ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** - UX –Ω–µ —Å—Ç—Ä–∞–¥–∞–µ—Ç
5. **üìù –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ª–µ–≥–∫–æ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å
6. **üéØ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è** - –æ–¥–Ω–æ –º–µ—Å—Ç–æ –¥–ª—è –≤—Å–µ–π –ª–æ–≥–∏–∫–∏
7. **üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º–∞—è** - —á–∏—Å—Ç—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±–µ–∑ side effects
8. **üì¶ –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–∞—è** - –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–µ–∑–¥–µ

---

## üöÄ –î–∞–ª—å–Ω–µ–π—à–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### –í–æ–∑–º–æ–∂–Ω—ã–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏:

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π refresh —Ç–æ–∫–µ–Ω–æ–≤**
   ```typescript
   if (isTokenExpired(token, 300)) { // 5 –º–∏–Ω—É—Ç –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è
     await refreshToken();
   }
   ```

2. **–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
   ```typescript
   if (isTokenExpired(token, 600)) { // 10 –º–∏–Ω—É—Ç –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è
     showNotification('–°–µ—Å—Å–∏—è —Å–∫–æ—Ä–æ –∏—Å—Ç–µ—á—ë—Ç');
   }
   ```

3. **–ú–µ—Ç—Ä–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**
   ```typescript
   trackTokenExpiration({
     userId: user.id,
     timeUntilExpiry: getTimeUntilExpiry(token)
   });
   ```

4. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤**
   ```typescript
   const tokenCache = new Map();
   // –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç isTokenExpired –Ω–∞ 1 —Å–µ–∫—É–Ω–¥—É
   ```

---

## üìö –°–≤—è–∑–∞–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- `/IMMEDIATE-FIX-TOKEN.md` - –ë—ã—Å—Ç—Ä–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `/JWT-EXPIRATION-FIX.md` - –ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
- `/TOKEN-ERROR-FIX-GUIDE.md` - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—é –æ—à–∏–±–æ–∫
- `/QUICK-FIX-EXPIRED-TOKEN.md` - –ö—Ä–∞—Ç–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏

---

**–í–µ—Ä—Å–∏—è**: 1.0.0  
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 2025-11-01  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ  
**–ê–≤—Ç–æ—Ä**: AI Assistant  

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 2025-11-01
