# Демонстрация интерактивной установки

## Как это выглядит

```
╔══════════════════════════════════════════════════════════════╗
║                                                              ║
║   ██╗  ██╗ ██████╗ ███╗   ██╗██╗   ██╗███████╗██████╗ ████████╗
║   ██║ ██╔╝██╔═══██╗████╗  ██║██║   ██║██╔════╝██╔══██╗╚══██╔══╝
║   █████╔╝ ██║   ██║██╔██╗ ██║██║   ██║█████╗  ██████╔╝   ██║   
║   ██╔═██╗ ██║   ██║██║╚██╗██║╚██╗ ██╔╝██╔══╝  ██╔══██╗   ██║   
║   ██║  ██╗╚██████╔╝██║ ╚████║ ╚████╔╝ ███████╗██║  ██║   ██║   
║   ╚═╝  ╚═╝ ╚═════╝ ╚═╝  ╚═══╝  ╚═══╝  ╚══════╝╚═╝  ╚═╝   ╚═╝   
║                                                              ║
║                  Интерактивная установка                     ║
║                                                              ║
╚══════════════════════════════════════════════════════════════╝

ℹ Этот скрипт поможет вам настроить backend для чата Конверт
ℹ Путь к приложению: /var/www/konvert-chat


╔════════════════════════════════════════════════════╗
║  Шаг 1: Настройка PocketBase
╚════════════════════════════════════════════════════╝

? Хост PocketBase [127.0.0.1]: 
? Порт PocketBase [54739]: 
ℹ Проверка доступности PocketBase на http://127.0.0.1:54739...
✓ PocketBase доступен


╔════════════════════════════════════════════════════╗
║  Шаг 2: Авторизация в PocketBase
╚════════════════════════════════════════════════════╝

ℹ Для создания коллекций требуется администратор PocketBase
ℹ Если вы еще не создали администратора, откройте:
ℹ http://127.0.0.1:54739/_/

? Вы уже создали администратора PocketBase? [Y/n]: y
? Email администратора: admin@konvert.local
? Пароль администратора: ********


╔════════════════════════════════════════════════════╗
║  Шаг 3: Настройка Redis
╚════════════════════════════════════════════════════╝

? Хост Redis [localhost]: 
? Порт Redis [6379]: 
? База данных Redis [0]: 
ℹ Проверка подключения к Redis...
✓ Redis доступен на localhost:6379


╔════════════════════════════════════════════════════╗
║  Шаг 4: Настройка функционала
╚════════════════════════════════════════════════════╝

ℹ Включите нужные функции (по умолчанию все включены):

? Включить E2EE шифрование? [Y/n]: y
? Включить real-time обновления? [Y/n]: y
? Включить загрузку файлов? [Y/n]: y
? Включить голосовые/видео сообщения? [Y/n]: y
? Включить режим 'Глаз Бога' (только для первого пользователя)? [Y/n]: y
? Включить систему достижений? [Y/n]: y


╔════════════════════════════════════════════════════╗
║  Шаг 5: Генерация ключей безопасности
╚════════════════════════════════════════════════════╝

ℹ Генерация JWT и ключей шифрования...
✓ JWT Secret сгенерирован: aB3dE5fG7h...
✓ Encryption Key сгенерирован: xY9zW1vU3t...


╔════════════════════════════════════════════════════╗
║  Шаг 6: Настройка приложения
╚════════════════════════════════════════════════════╝

? Режим работы [production]: 
? Порт frontend приложения [3000]: 
? Хост frontend приложения [0.0.0.0]: 


╔════════════════════════════════════════════════════╗
║  Резюме конфигурации
╚════════════════════════════════════════════════════╝

PocketBase:
  URL: http://127.0.0.1:54739
  Администратор: admin@konvert.local

Redis:
  Хост: localhost
  Порт: 6379
  База: 0

Приложение:
  Порт: 3000
  Хост: 0.0.0.0
  Режим: production

Функции:
  E2EE: ✓
  Real-time: ✓
  Загрузка файлов: ✓
  Голос/видео: ✓
  Глаз Бога: ✓
  Достижения: ✓

? Продолжить установку с этими настройками? [Y/n]: y


▶ Создание backend-setup/.env

✓ backend-setup/.env создан


▶ Создание .env для frontend

✓ .env создан


▶ Установка зависимостей backend

? Установить NPM зависимости для backend? [Y/n]: y
ℹ Установка пакетов...
✓ Зависимости backend установлены


▶ Создание коллекций PocketBase

? Создать коллекции в PocketBase сейчас? [Y/n]: y
🔄 Подключение к PocketBase...
✓ PocketBase доступен

🔐 Авторизация администратора...
Используются учетные данные из .env файла
✓ Авторизация успешна

📋 Получение списка коллекций...
📦 Создание коллекции "users"...
✓ Коллекция "users" создана (ID: abc123def456)
📦 Создание коллекции "rooms"...
✓ Коллекция "rooms" создана (ID: ghi789jkl012)
📦 Создание коллекции "messages"...
✓ Коллекция "messages" создана (ID: mno345pqr678)
📦 Создание коллекции "achievements"...
✓ Коллекция "achievements" создана (ID: stu901vwx234)
📦 Создание коллекции "user_achievements"...
✓ Коллекция "user_achievements" создана (ID: yza567bcd890)
📦 Создание коллекции "friend_requests"...
✓ Коллекция "friend_requests" создана (ID: efg123hij456)
📦 Создание коллекции "files"...
✓ Коллекция "files" создана (ID: klm789nop012)

🏆 Создание дефолтных достижений...
  ✓ Создано: 🎉 Первое сообщение
  ✓ Создано: 🌙 Полуночник
  ✓ Создано: 💬 Болтун
  ✓ Создано: 🔥 На огне
  ✓ Создано: ⚡ Скорострел
  ✓ Создано: 🎄 Новогоднее чудо
  ✓ Создано: 👥 Социальная бабочка
  ✓ Создано: ❤️ Популярный

==================================================
✅ Создание коллекций завершено!
==================================================
Создано:     7
Существует:  0
Ошибок:      0
==================================================


▶ Установка зависимостей frontend

? Установить NPM зависимости для frontend? [Y/n]: y
ℹ Установка пакетов... (это может занять несколько минут)
✓ Зависимости frontend установлены


▶ Создание необходимых директорий

✓ Директории созданы


▶ Тестирование подключений

? Запустить тесты подключения? [Y/n]: y

╔════════════════════════════════════════╗
║  Тест подключения Backend "Конверт"  ║
╚════════════════════════════════════════╝


=== Тестирование PocketBase ===

✓ Подключение: http://127.0.0.1:54739
✓ Коллекций найдено: 7
  ✓ Коллекция "users" существует
  ✓ Коллекция "rooms" существует
  ✓ Коллекция "messages" существует
  ✓ Коллекция "achievements" существует
✓ Коллекция users: 0 пользователей
✓ Коллекция rooms: 0 комнат
✓ Коллекция messages: 0 сообщений


=== Тестирование Redis ===

✓ Подключение: localhost:6379
✓ SET/GET работает корректно
✓ Pub/Sub работает корректно
✓ Информация Redis:
  • Версия: 7.0.12
  • Память: 1.23M
  • Uptime: 142 минут
  • Подключений: 2


=== Итоги тестирования ===

PocketBase: 5/5 тестов пройдено
Redis:      4/4 тестов пройдено

✓ Все тесты пройдены успешно!
✓ Backend готов к использованию


▶ Создание systemd сервисов

? Создать systemd сервис для автозапуска? [y/N]: n


╔════════════════════════════════════════════════════╗
║  Установка завершена! 🎉
╚════════════════════════════════════════════════════╝

✓ Конфигурация создана
✓ Зависимости установлены
✓ PocketBase доступен
✓ Redis доступен

ℹ Следующие шаги:

  1. Запустите приложение в режиме разработки:
     cd /var/www/konvert-chat
     npm run dev

  2. Или соберите для production:
     npm run build
     npm run preview

  3. Откройте в браузере:
     http://localhost:3000

ℹ Полезные ссылки:
  PocketBase Admin: http://127.0.0.1:54739/_/
  PocketBase API: http://127.0.0.1:54739/api/

⚠ ВАЖНО: Сохраните эти учетные данные в безопасном месте!

  JWT_SECRET=aB3dE5fG7h9iJ1kL3mN5oP7qR9sT1uV3
  ENCRYPTION_KEY=xY9zW1vU3tS5rQ7pO9nM1lK3jI5hG7fE
  PocketBase Admin=admin@konvert.local

✓ Готово! Приятного использования чата Конверт! 🚀
```

## Что дальше?

После успешной установки:

1. Запустите приложение:
   ```bash
   cd ..
   npm run dev
   ```

2. Откройте http://localhost:3000

3. Зарегистрируйте первого пользователя (получит права администратора)

4. Начните использовать чат!

## Смотрите также

- [USAGE.md](USAGE.md) - Подробное руководство по использованию
- [README.md](README.md) - Документация backend
- [../QUICKSTART.md](../QUICKSTART.md) - Быстрый старт
